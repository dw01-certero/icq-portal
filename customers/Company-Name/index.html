<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ITAM ICQ - Company Name</title>
<style>
/* ── CSS Variables & Theme ── */
:root {
  --bg: #0c0a1a;
  --bg-secondary: #120f24;
  --bg-card: #17132e;
  --bg-card-hover: #1e1940;
  --bg-input: #0e0b1e;
  --border: #2a2050;
  --border-focus: #7a00df;
  --accent: #7a00df;
  --accent-mid: #4721fb;
  --accent-glow: rgba(122, 0, 223, 0.25);
  --cyan: #34e2e4;
  --cyan-glow: rgba(52, 226, 228, 0.15);
  --green: #00d084;
  --amber: #f59e0b;
  --red: #ef4444;
  --text: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --radius: 8px;
  --radius-lg: 12px;
  --gradient-brand: linear-gradient(135deg, #34e2e4, #4721fb, #ab1dfe);
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  line-height: 1.5;
}

/* ── Scrollbar ── */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

/* ── Gate Modal ── */
.gate-overlay {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 2000;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.3s;
}
.gate-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}
.gate-modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 40px;
  max-width: 460px;
  width: 90%;
  text-align: center;
}
.gate-modal h2 {
  font-size: 1.6rem;
  font-weight: 700;
  background: var(--gradient-brand);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 4px;
}
.gate-modal .subtitle {
  font-size: 0.85rem;
  color: var(--text-muted);
  margin-bottom: 28px;
}
.gate-modal label {
  display: block;
  text-align: left;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.gate-input {
  width: 100%;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  padding: 12px 14px;
  font-size: 0.95rem;
  font-family: inherit;
  transition: border-color 0.2s;
  margin-bottom: 6px;
}
.gate-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.gate-input::placeholder { color: var(--text-muted); }
.gate-error {
  font-size: 0.75rem;
  color: var(--red);
  min-height: 20px;
  margin-bottom: 16px;
  text-align: left;
}
.gate-toggle-label {
  display: block;
  text-align: left;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 8px;
}
.gate-toggle-container {
  display: flex;
  gap: 0;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 3px;
  margin-bottom: 24px;
}
.gate-toggle-btn {
  flex: 1;
  padding: 8px 16px;
  border: none;
  background: transparent;
  color: var(--text-muted);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 16px;
  transition: all 0.25s;
}
.gate-toggle-btn.active {
  background: var(--accent-mid);
  color: #fff;
  box-shadow: 0 0 12px var(--accent-glow);
}
.gate-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.gate-start-btn {
  width: 100%;
  padding: 12px;
  background: var(--accent);
  border: none;
  border-radius: var(--radius);
  color: #fff;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.2s;
}
.gate-start-btn:hover { background: #6600bd; }
.gate-load-btn {
  width: 100%;
  padding: 10px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text-secondary);
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
.gate-load-btn:hover { border-color: var(--accent); color: var(--text); }
.gate-divider {
  font-size: 0.7rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* ── App Wrapper ── */
.app-wrapper {
  display: none;
}
.app-wrapper.visible {
  display: block;
}

/* ── Header ── */
.header {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  flex-wrap: wrap;
}
.header-brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.header-brand h1 {
  font-size: 1.25rem;
  font-weight: 700;
  background: var(--gradient-brand);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.header-brand .version {
  font-size: 0.7rem;
  color: var(--text-muted);
  padding: 2px 8px;
  border: 1px solid var(--border);
  border-radius: 10px;
}
.header-controls {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}
.customer-display {
  font-size: 0.85rem;
  color: var(--cyan);
  font-weight: 600;
  padding: 8px 12px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  max-width: 220px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* ── Toggle Switch ── */
.toggle-container {
  display: flex;
  align-items: center;
  gap: 0;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 3px;
}
.toggle-btn {
  padding: 6px 16px;
  border: none;
  background: transparent;
  color: var(--text-muted);
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 16px;
  transition: all 0.25s;
}
.toggle-btn.active {
  background: var(--accent-mid);
  color: #fff;
  box-shadow: 0 0 12px var(--accent-glow);
}

/* ── Buttons ── */
.btn {
  padding: 8px 16px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text);
  font-size: 0.8rem;
  font-weight: 600;
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}
.btn:hover { border-color: var(--accent); background: var(--bg-card-hover); }
.btn-accent { background: var(--accent); border-color: var(--accent); color: #fff; }
.btn-accent:hover { background: #6600bd; }
.btn-green { background: var(--green); border-color: var(--green); color: #fff; }
.btn-green:hover { background: #0d9668; }
.btn-danger { border-color: var(--red); color: var(--red); }
.btn-danger:hover { background: rgba(239, 68, 68, 0.1); }

/* ── Hidden file input ── */
.hidden-input { display: none; }

/* ── Save Indicator ── */
.save-indicator {
  font-size: 0.75rem;
  color: var(--green);
  opacity: 0;
  transition: opacity 0.3s;
}
.save-indicator.show { opacity: 1; }

/* ── Sticky Stats ── */
.sticky-stats {
  position: sticky;
  z-index: 90;
  background: var(--bg);
  border-bottom: 1px solid var(--border);
  padding-bottom: 0;
}

/* ── Summary Cards ── */
.summary-bar {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;
  padding: 10px 24px;
  max-width: 1200px;
  margin: 0 auto;
}
.summary-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 8px 12px;
  text-align: center;
}
.summary-card .label {
  font-size: 0.6rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  margin-bottom: 2px;
}
.summary-card .value {
  font-size: 1.2rem;
  font-weight: 700;
}
.summary-card .value.cyan { color: var(--cyan); }
.summary-card .value.green { color: var(--green); }
.summary-card .value.amber { color: var(--amber); }
.summary-card .value.accent { color: var(--accent); }

/* ── Progress Bar ── */
.progress-bar-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px 8px;
}
.progress-bar-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 6px;
}
.progress-bar-label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.progress-bar-percent {
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--accent);
}
.progress-bar-outer {
  height: 8px;
  background: var(--bg-input);
  border-radius: 4px;
  overflow: hidden;
}
.progress-bar-fill {
  height: 100%;
  background: var(--gradient-brand);
  border-radius: 4px;
  transition: width 0.4s ease;
}

/* ── Tabs ── */
.tabs-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px 8px;
  display: flex;
  gap: 4px;
}
.tab-btn {
  padding: 10px 20px;
  background: transparent;
  border: none;
  color: var(--text-muted);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
}
.tab-btn:hover { color: var(--text); }
.tab-btn.active {
  color: var(--cyan);
  border-bottom-color: var(--cyan);
}
.tab-btn .badge {
  display: inline-block;
  background: var(--accent-mid);
  color: #fff;
  font-size: 0.65rem;
  padding: 1px 7px;
  border-radius: 10px;
  margin-left: 6px;
  font-weight: 700;
}

/* ── Main Content ── */
.main-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 16px 24px 48px;
}

/* ── Category Header ── */
.category-header {
  font-size: 1rem;
  font-weight: 700;
  color: var(--cyan);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin: 24px 0 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

/* ── Section ── */
.section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  margin-bottom: 12px;
  overflow: visible;
  transition: opacity 0.3s;
}
.section.out-of-scope {
  opacity: 0.4;
}
.section.locked-scope {
  opacity: 0.35;
}
.section.locked-scope .section-body {
  pointer-events: none;
}
.section.locked-scope .scope-toggle {
  display: none;
}
.locked-notice {
  padding: 12px 18px;
  font-size: 0.8rem;
  color: var(--amber);
  border: 1px dashed var(--amber);
  border-radius: var(--radius);
  margin: 12px 18px;
  text-align: center;
}
.customer-banner {
  font-size: 0.75rem;
  color: var(--text-muted);
  padding: 4px 12px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  white-space: nowrap;
}
.section.hidden { display: none; }
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 18px;
  cursor: pointer;
  user-select: none;
  transition: background 0.2s;
  position: sticky;
  z-index: 80;
  background: var(--bg-card);
  border-radius: var(--radius-lg) var(--radius-lg) 0 0;
  gap: 8px;
  flex-wrap: wrap;
}
.section-header:hover { background: var(--bg-card-hover); }
.section-header { border-bottom: 1px solid var(--border); }
.section.collapsed .section-header { border-bottom: none; }
.section-header-left {
  display: flex;
  align-items: center;
  gap: 10px;
  flex: 1;
}
.section-chevron {
  font-size: 0.7rem;
  color: var(--text-muted);
  transition: transform 0.2s;
  width: 16px;
}
.section.collapsed .section-chevron { transform: rotate(-90deg); }
.section-title {
  font-size: 0.9rem;
  font-weight: 600;
}
.section-title .section-ref {
  color: var(--accent);
  margin-right: 6px;
}
.section-progress {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-left: 8px;
  white-space: nowrap;
}
.section-header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}
.new-count-badge {
  font-size: 0.6rem;
  font-weight: 700;
  color: var(--amber);
  border: 1px solid var(--amber);
  padding: 1px 7px;
  border-radius: 10px;
  white-space: nowrap;
}

/* ── In Scope Toggle ── */
.scope-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.7rem;
  color: var(--text-muted);
  cursor: pointer;
}
.scope-toggle input[type="checkbox"] {
  accent-color: var(--accent);
  width: 14px;
  height: 14px;
}

/* ── Section Progress Bar ── */
.section-progress-bar {
  height: 3px;
  background: var(--bg-input);
  margin: 0 18px;
}
.section-progress-fill {
  height: 100%;
  background: var(--gradient-brand);
  border-radius: 2px;
  transition: width 0.4s ease;
}
.section.collapsed .section-progress-bar { display: none; }

/* ── Section Assignee (in header) ── */
.section-header-assignee {
  display: flex;
  align-items: center;
  gap: 6px;
  margin-left: 8px;
}
.section-header-assignee input {
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  padding: 4px 8px;
  font-size: 0.72rem;
  font-family: inherit;
  transition: border-color 0.2s;
  width: 240px;
}
.section-header-assignee input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.section-header-assignee input::placeholder { color: var(--text-muted); }

/* ── Tech Selector ── */
.tech-selector {
  padding: 14px 0;
  margin-bottom: 14px;
  border-bottom: 1px solid var(--border);
}
.tech-selector-label {
  font-size: 0.75rem;
  font-weight: 600;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  margin-bottom: 10px;
}
.tech-selector-options {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
}
.tech-option {
  display: flex;
  align-items: center;
  gap: 6px;
  padding: 6px 12px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 0.78rem;
  color: var(--text-secondary);
  cursor: pointer;
  transition: all 0.2s;
  user-select: none;
}
.tech-option:hover {
  border-color: var(--accent);
  color: var(--text);
}
.tech-option.selected {
  background: var(--accent-glow);
  border-color: var(--accent);
  color: var(--text);
}
.tech-option input[type="checkbox"] {
  accent-color: var(--accent);
  width: 14px;
  height: 14px;
}

/* ── Section Body ── */
.section-body {
  padding: 0 18px 18px;
  border-radius: 0 0 var(--radius-lg) var(--radius-lg);
  background: var(--bg-card);
}
.section.collapsed .section-body { display: none; }
.section.collapsed .section-header { border-radius: var(--radius-lg); }

/* ── Question Card ── */
.question-card {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  margin-bottom: 10px;
  background: var(--bg);
  transition: border-color 0.2s;
}
.question-card:hover { border-color: #2a3f65; }
.question-card.answered { border-left: 3px solid var(--green); }
.question-card.hidden { display: none; }

.question-header {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  margin-bottom: 8px;
}
.question-ref {
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--accent);
  white-space: nowrap;
  padding-top: 2px;
}
.question-text {
  font-size: 0.85rem;
  flex: 1;
}
.new-badge {
  display: inline-block;
  font-size: 0.6rem;
  font-weight: 700;
  color: #000;
  background: var(--amber);
  padding: 1px 7px;
  border-radius: 10px;
  white-space: nowrap;
}

/* ── Expand Toggles ── */
.expand-row {
  display: flex;
  gap: 12px;
  margin-bottom: 8px;
}
.expand-btn {
  font-size: 0.7rem;
  color: var(--text-muted);
  background: none;
  border: none;
  cursor: pointer;
  text-decoration: underline;
  text-decoration-style: dotted;
  transition: color 0.2s;
}
.expand-btn:hover { color: var(--cyan); }
.expand-content {
  display: none;
  font-size: 0.8rem;
  color: var(--text-secondary);
  background: var(--bg-secondary);
  border-radius: var(--radius);
  padding: 10px 12px;
  margin-bottom: 8px;
  border-left: 2px solid var(--accent);
}
.expand-content.show { display: block; }
.expand-label {
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: 4px;
}

/* ── Textarea / Input ── */
.question-input {
  width: 100%;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  padding: 10px;
  font-size: 0.85rem;
  font-family: inherit;
  resize: vertical;
  min-height: 60px;
  transition: border-color 0.2s;
}
.question-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.question-input::placeholder { color: var(--text-muted); }
select.question-input {
  min-height: unset;
  cursor: pointer;
}

/* ── Audit Modal ── */
.audit-modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  max-width: 700px;
  width: 95%;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
}
.audit-modal h3 { margin-bottom: 4px; font-size: 1rem; }
.audit-modal .audit-subtitle {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-bottom: 16px;
}
.audit-table-wrap {
  overflow-y: auto;
  flex: 1;
  margin-bottom: 16px;
}
.audit-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.78rem;
}
.audit-table th {
  text-align: left;
  padding: 8px 10px;
  border-bottom: 1px solid var(--border);
  color: var(--text-muted);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: sticky;
  top: 0;
  background: var(--bg-card);
}
.audit-table td {
  padding: 6px 10px;
  border-bottom: 1px solid var(--border);
  color: var(--text-secondary);
  vertical-align: top;
}
.audit-table tr:hover td { background: var(--bg-card-hover); }
.audit-type {
  display: inline-block;
  font-size: 0.65rem;
  font-weight: 700;
  padding: 1px 7px;
  border-radius: 10px;
  white-space: nowrap;
}
.audit-type.login { background: var(--accent); color: #fff; }
.audit-type.answer { background: var(--green); color: #fff; }
.audit-type.scope { background: var(--cyan); color: #000; }
.audit-type.load { background: var(--amber); color: #000; }
.audit-type.reset { background: var(--red); color: #fff; }
.audit-type.export { background: var(--text-muted); color: #fff; }
.audit-empty {
  text-align: center;
  padding: 32px;
  color: var(--text-muted);
  font-size: 0.85rem;
}

/* ── Modal ── */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
.modal-overlay.show { display: flex; }
.modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  max-width: 400px;
  width: 90%;
}
.modal h3 { margin-bottom: 12px; font-size: 1rem; }
.modal p { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 20px; }
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

/* ── Responsive ── */
@media (max-width: 768px) {
  .header-top { flex-direction: column; align-items: stretch; }
  .header-controls { flex-wrap: wrap; }
  .customer-display { max-width: 100%; }
  .summary-bar { grid-template-columns: repeat(2, 1fr); }
  .expand-row { flex-direction: column; gap: 4px; }
  .gate-modal { padding: 24px; }
}
@media (max-width: 480px) {
  .summary-bar { grid-template-columns: 1fr; }
  .header { padding: 12px 12px; }
  .main-content { padding: 12px 12px 48px; }
  .tabs-container { padding: 0 12px 12px; }
}
</style>
</head>
<body>

<!-- ── Gate Modal ── -->
<div class="gate-overlay" id="gateOverlay">
  <div class="gate-modal">
    <h2>ITAM ICQ</h2>
    <div class="subtitle">Implementation &amp; Configuration Questionnaire</div>
    <label for="gateUserName">Your Name</label>
    <input type="text" class="gate-input" id="gateUserName" placeholder="Enter your name..." autofocus />
    <label for="gateCustomerName" style="margin-top:12px">Customer Name</label>
    <input type="text" class="gate-input" id="gateCustomerName" placeholder="Enter customer name..." />
    <div class="gate-error" id="gateError"></div>
    <div class="gate-toggle-label">Deployment Type</div>
    <div class="gate-toggle-container">
      <button class="gate-toggle-btn active" data-gmode="onprem" onclick="setGateMode('onprem')">On-Prem</button>
      <button class="gate-toggle-btn" data-gmode="saas" onclick="setGateMode('saas')">SaaS</button>
    </div>
    <div class="gate-actions">
      <button class="gate-start-btn" onclick="startICQ()">Start Questionnaire</button>
      <div class="gate-divider">or</div>
      <button class="gate-load-btn" onclick="document.getElementById('gateLoadFile').click()">Load Saved Progress</button>
      <input type="file" class="hidden-input" id="gateLoadFile" accept=".json" onchange="loadProgressFile(this, true)" />
    </div>
  </div>
</div>

<!-- ── App Wrapper ── -->
<div class="app-wrapper" id="appWrapper">

<!-- ── Header ── -->
<div class="header">
  <div class="header-top">
    <div class="header-brand">
      <h1>ITAM ICQ &#8212; Company Name</h1>
      <span class="version">v2.0</span>
    </div>
    <div class="header-controls">
      <span class="customer-display" id="customerDisplay"></span>
      <div class="toggle-container">
        <button class="toggle-btn active" data-mode="onprem" onclick="setMode('onprem')">On-Prem</button>
        <button class="toggle-btn" data-mode="saas" onclick="setMode('saas')">SaaS</button>
      </div>
      <button class="btn btn-green" onclick="saveProgress()">&#x1f4be; Save Progress</button>
      <button class="btn" onclick="document.getElementById('loadFileInput').click()">Load</button>
      <input type="file" class="hidden-input" id="loadFileInput" accept=".json" onchange="loadProgressFile(this, false)" />
      <button class="btn" onclick="showAuditModal()">Audit Log</button>
      <button class="btn btn-accent" onclick="exportJSON()">&#x2913; Export</button>
      <button class="btn btn-danger" onclick="showResetModal()" style="display:none">Reset</button>
      <span class="save-indicator" id="saveIndicator">Saved</span>
    </div>
  </div>
</div>

<!-- ── Sticky Stats ── -->
<div class="sticky-stats" id="stickyStats">

<!-- ── Summary Cards ── -->
<div class="summary-bar">
  <div class="summary-card">
    <div class="label">Total Sections</div>
    <div class="value cyan" id="statTotal">0</div>
  </div>
  <div class="summary-card">
    <div class="label">Answered</div>
    <div class="value green" id="statAnswered">0</div>
  </div>
  <div class="summary-card">
    <div class="label">Remaining</div>
    <div class="value amber" id="statRemaining">0</div>
  </div>
  <div class="summary-card">
    <div class="label">Progress</div>
    <div class="value accent" id="statProgress">0%</div>
  </div>
</div>

<!-- ── Progress Bar ── -->
<div class="progress-bar-container">
  <div class="progress-bar-header">
    <span class="progress-bar-label">Overall Progress</span>
    <span class="progress-bar-percent" id="progressBarPercent">0%</span>
  </div>
  <div class="progress-bar-outer">
    <div class="progress-bar-fill" id="progressBarFill" style="width:0%"></div>
  </div>
</div>

<!-- ── Tabs ── -->
<div class="tabs-container">
  <button class="tab-btn active" data-tab="full" onclick="setTab('full')">Full ICQ <span class="badge" id="tabFullCount">0</span></button>
  <button class="tab-btn" data-tab="oos" onclick="setTab('oos')">Out of Scope <span class="badge" id="tabOosCount">0</span></button>
  <button class="tab-btn" data-tab="new" onclick="setTab('new')">New Questions <span class="badge" id="tabNewCount">0</span></button>
</div>

</div><!-- /sticky-stats -->

<!-- ── Main Content ── -->
<div class="main-content" id="mainContent"></div>

<!-- ── Reset Modal ── -->
<div class="modal-overlay" id="resetModal">
  <div class="modal">
    <h3>Reset All Responses?</h3>
    <p>This will permanently clear all answers, customer name, and saved preferences. This cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn" onclick="hideResetModal()">Cancel</button>
      <button class="btn btn-danger" onclick="doReset()">Reset Everything</button>
    </div>
  </div>
</div>

<!-- ── Audit Log Modal ── -->
<div class="modal-overlay" id="auditModal">
  <div class="audit-modal">
    <h3>Audit Log</h3>
    <div class="audit-subtitle">Tracks logins, answer changes, and actions</div>
    <div class="audit-table-wrap" id="auditTableWrap"></div>
    <div class="modal-actions">
      <button class="btn" onclick="exportAuditLog()">Download CSV</button>
      <button class="btn" onclick="hideAuditModal()">Close</button>
    </div>
  </div>
</div>

</div><!-- /app-wrapper -->

<script>
/* ═══════════════════════════════════════════════
   ICQ DATA - All sections and questions
   ═══════════════════════════════════════════════ */
const ICQ_DATA = {
  meta: {
    title: "ITAM Implementation & Configuration Questionnaire",
    version: "2.0",
    lastUpdated: "2026-02-13"
  },
  sections: [
    /* ─── 1.x ABOUT YOU ─── */
    {
      id: "1.0", title: "Environment Overview", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.0.1", text: "How would you describe the overall complexity of your IT environment?", whyRelevant: "Helps us gauge the level of effort and expertise required for a successful implementation.", exampleResponse: "Complex", scope: "both", isNew: true, inputType: "select", options: ["Simple — single site, under 1,000 devices, one OS type", "Moderate — 2–5 sites, 1,000–10,000 devices, a few OS types", "Complex — 6–20 sites, 10,000–50,000 devices, mixed OS and cloud", "Very Complex — 20+ sites/countries, 50,000+ devices, multiple BUs and outsourced IT"] },
        { ref: "1.0.2", text: "How many total devices (servers, workstations, virtual machines) are approximately in scope?", whyRelevant: "Determines solution sizing, licensing tier, and infrastructure requirements.", exampleResponse: "10,001–50,000", scope: "both", isNew: true, inputType: "select", options: ["Under 1,000", "1,000–5,000", "5,001–10,000", "10,001–50,000", "50,001–100,000", "Over 100,000"] },
        { ref: "1.0.3", text: "How many countries or regions does your IT infrastructure span?", whyRelevant: "Multi-region deployments add complexity around time zones, network topology, and data sovereignty.", exampleResponse: "6–20 countries", scope: "both", isNew: true, inputType: "select", options: ["1 country", "2–5 countries", "6–20 countries", "Over 20 countries"] },
        { ref: "1.0.4", text: "How mature is your current IT Asset Management practice?", whyRelevant: "Understanding maturity helps tailor the implementation approach, training requirements, and expected timeline.", exampleResponse: "Intermediate", scope: "both", isNew: true, inputType: "select", options: ["No formal ITAM — no dedicated process or tools", "Basic — spreadsheets or manual tracking only", "Intermediate — some tooling in place but gaps remain", "Advanced — dedicated ITAM tool with established processes"] },
        { ref: "1.0.5", text: "Do you have any upcoming vendor audits or licence compliance deadlines?", whyRelevant: "Audit timelines often drive implementation priority and urgency.", exampleResponse: "Yes, within the next 6 months", scope: "both", isNew: true, inputType: "select", options: ["No", "Yes, within the next 3 months", "Yes, within the next 6 months", "Yes, within the next 12 months", "Unsure"] },
        { ref: "1.0.6", text: "How many separate IT teams or managed service providers will need to be coordinated for this project?", whyRelevant: "Multiple teams increase coordination complexity and can impact project timelines.", exampleResponse: "3–5 teams", scope: "both", isNew: true, inputType: "select", options: ["1 (single central IT team)", "2–3 teams", "4–6 teams", "7+ teams or MSPs"] }
      ]
    },
    {
      id: "1.1", title: "Organizational Structure", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.1.1", text: "Please provide a list of your primary geographic locations.", whyRelevant: "Understand overall structure of the organization.", exampleResponse: "US: Chicago, New York, Atlanta\nUK: London, Manchester\nAMER / EMEA / APAC", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.1.2", text: "If you have any datacentres, please provide the following information for each:\n- Name\n- Location\n- Size (number of servers)\n- Description", whyRelevant: "Understand overall structure of the organization.", exampleResponse: "Name: Chicago DC1\nLocation: Chicago\nSize: 500 Servers (Physical and Virtual)\nDescription: Primary US Datacentre", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.1.3", text: "Does your organization function as a single entity, or do you have multiple business units or departments that work independently (e.g. each having their own IT function)?", whyRelevant: "Understand overall structure of the organization and how the project is to engage.", exampleResponse: "We have 2 business units that operate independently from each other, distributed across all listed locations.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.1.4", text: "Where you have individual business units/departments operating with some level of autonomy, please provide for each:\n- Business Unit name\n- Description\n- Estimated number of assets\n- Level of autonomy\n- Business Unit owner contact details", whyRelevant: "Understand overall structure of the organization. The autonomy information helps determine if separate project streams are needed.", exampleResponse: "Business Unit Name: AnyCo Manufacturing\nDescription: Manufacturing side of the business\nEstimated assets: 5,000\nAutonomy: Functions as totally independent business with own IT team\nContact: John Smith, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "1.2", title: "Number & Type of Devices", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.2.1", text: "Target number of Windows Servers?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "4,500", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.2", text: "Please provide a technical contact for Windows Servers.", whyRelevant: "Someone who understands how these servers are managed within your estate.", exampleResponse: "John Smith, Windows Server Administrator, john.smith@anyco.com, Tel: (555) 123 4567", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.3", text: "Please provide the FQDN of a sample Windows Server that will be used to confirm the operability of agentless inventory.", whyRelevant: "The server provided here will be used to confirm the agentless inventory capability of the solution is fully operational.", exampleResponse: "winserv01.anyco.local", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.4", text: "Target number of Windows Workstations?", whyRelevant: "To provide a common understanding of the number of devices in your IT estate.", exampleResponse: "27,575", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.5", text: "Please provide a technical contact for Windows Workstations.", whyRelevant: "Someone who understands how workstations are managed within your estate.", exampleResponse: "John Smith, Desktop Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.6", text: "Certero would typically use the capability within the solution to deploy the Client Agent. Please confirm this is acceptable or if you prefer to use another 3rd party tool for agent deployment.", whyRelevant: "To understand how you intend to deploy the Certero Client agent - using the inbuilt capability of Certero, or using a 3rd party tool such as SCCM.", exampleResponse: "Using Certero is acceptable", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.7", text: "Do you use VDI for workstations?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No"] },
        { ref: "1.2.8", text: "If you use VDI, do you have persistent or non-persistent VDI?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "Persistent", scope: "both", isNew: false, inputType: "select", options: ["Persistent", "Non-persistent", "Both"] },
        { ref: "1.2.9", text: "Do you use any Thin Client devices?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No"] },
        { ref: "1.2.10", text: "If you use Thin Client devices, how many do you have and what are their manufacturers?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "350 x Wyse, 100 x HP", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.11", text: "Do you have any internet-based devices that are in scope of the solution?", whyRelevant: "The solution can have a specific Endpoint Server to capture any devices such as remote or mobile workers that connect over the internet.", exampleResponse: "Yes, AWS and Azure are in scope of this engagement.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.12", text: "How many Linux systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "1,320", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.13", text: "Please provide a technical contact for Linux systems.", whyRelevant: "Someone who understands how Linux systems are managed within your estate.", exampleResponse: "John Smith, Linux Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.14", text: "Please provide the FQDN & IP address of a sample Linux system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "linuxserv01.anyco.local / 192.168.20.1", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.15", text: "How many Solaris systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "25", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.16", text: "Please provide a technical contact for Solaris systems.", whyRelevant: "Someone who understands how Solaris systems are managed within your estate.", exampleResponse: "John Smith, Solaris Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.17", text: "Please provide the FQDN & IP address of a sample Solaris system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "solserv01.anyco.local / 192.168.20.2", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.18", text: "How many HP-UX systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "20", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.19", text: "Please provide a technical contact for HP-UX systems.", whyRelevant: "Someone who understands how HP-UX systems are managed within your estate.", exampleResponse: "John Smith, HP Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.20", text: "Please provide the FQDN & IP address of a sample HP-UX system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "hpuxserv01.anyco.local / 192.168.20.3", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.21", text: "How many AIX systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "42", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.22", text: "Please provide a technical contact for AIX systems.", whyRelevant: "Someone who understands how AIX systems are managed within your estate.", exampleResponse: "John Smith, IBM Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.23", text: "Please provide the FQDN & IP address of a sample AIX system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "aixserv01.anyco.local / 192.168.20.4", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.24", text: "For any non-Windows systems, are you able to provide an RSA key for authentication?", whyRelevant: "RSA key-based authentication is the most efficient method of obtaining inventory of non-Windows based systems.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No", "Not applicable"] },
        { ref: "1.2.25", text: "How many macOS systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "250", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.2.26", text: "Please provide a technical contact for macOS systems.", whyRelevant: "Someone who understands how macOS systems are managed within your estate.", exampleResponse: "John Appleseed, Apple System Administrator, john.appleseed@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.2.27", text: "Please provide the FQDN & IP address of a sample macOS system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "macos01.anyco.local / 192.168.20.5", scope: "both", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "1.3", title: "Active Directory", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.3.1", text: "For each Active Directory domain, please provide:\n- Active Directory Domain Name (NetBIOS Name)\n- DNS Domain Name\n- Two Domain Controllers\n\nWe will require an Active Directory (AD) user account for each AD domain.", whyRelevant: "Active Directory connectors are needed for each domain to discover and inventory computers and users.", exampleResponse: "Domain Name: JONES\nDNS Domain: jones.local\nControllers: J-DC01, J-DC02\n\nDomain Name: APPLESEED\nDNS Domain: appleseed.com\nControllers: A-DC01, A-DC02", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.3.2", text: "Do you use Azure Active Directory (Entra ID) in addition to on-premises Active Directory?", whyRelevant: "Azure AD / Entra ID connectivity enables cloud-based user and device discovery.", exampleResponse: "Yes, we use Azure AD with hybrid join.", scope: "both", isNew: true, inputType: "select", options: ["Yes, with hybrid join", "Yes, cloud-only", "No", "Unsure"] },
        { ref: "1.3.3", text: "If using Azure AD, please provide the Tenant ID and primary domain.", whyRelevant: "Required to configure the Azure AD connector for user and device synchronization.", exampleResponse: "Tenant ID: bf5c98bb-bc86-4550-bbe1-d3c3629b01dc\nPrimary domain: anyco.onmicrosoft.com", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "1.4", title: "Email", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.4.1", text: "Do you use Office 365 for mail?", whyRelevant: "Will feed into the solution design and any required prerequisites.", exampleResponse: "No", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No"] },
        { ref: "1.4.2", text: "Do you have any on-premise Exchange server infrastructure?", whyRelevant: "Will feed into the solution design and any required prerequisites.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No"] },
        { ref: "1.4.3", text: "If you have an on-premise Exchange server, please provide the server name.", whyRelevant: "This will be used to help create a connector to your Exchange server.", exampleResponse: "ex01.anyco.local", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.4.4", text: "If you have an on-premise Exchange server, please confirm the Exchange Server has an Information Store.", whyRelevant: "This is required for the connector to function correctly.", exampleResponse: "Yes, it has been configured with access to an Information Store.", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No", "Not applicable"] }
      ]
    },
    {
      id: "1.5", title: "Virtualization", category: "about-you",
      scope: "both", conditional: false,
      hasTechSelector: true,
      techOptions: [
        { key: "vmware", label: "VMware vSphere / ESXi" },
        { key: "nutanix", label: "Nutanix AHV" },
        { key: "xenserver", label: "Citrix XenServer / Hypervisor" },
        { key: "ovirt", label: "oVirt / Red Hat Virtualization" },
        { key: "oraclevm", label: "Oracle VM" },
        { key: "ibmhmc", label: "IBM PowerVM (HMC)" },
        { key: "hyperv", label: "Microsoft Hyper-V" }
      ],
      questions: [
        { ref: "1.5.1", text: "Please provide technical contacts for each of your Virtualization technologies.", whyRelevant: "Those who understand and manage your virtualization technologies within your estate.", exampleResponse: "VMware: John Smith, john.smith@anyco.com\noVirt: Jane Doe, jane.doe@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.5.2", text: "Please provide the FQDN of each VMware vCenter server you have, together with their IP address.", whyRelevant: "We will require an Active Directory User account with the Read Role to each VMware vCenter server.", exampleResponse: "vc01.anyco.local (10.0.1.10)\nvc02.anyco.local (10.0.2.10)", scope: "both", isNew: false, inputType: "textarea", techGroup: "vmware" },
        { ref: "1.5.3", text: "Please provide the FQDN of each standalone ESX server you have. Do not include any that are already managed by a vCentre server.", whyRelevant: "For standalone ESX servers, only the root account can be used to ensure the right information is obtained.", exampleResponse: "esx01.anyco.local\nesx02.anyco.local", scope: "both", isNew: false, inputType: "textarea", techGroup: "vmware" },
        { ref: "1.5.4", text: "Please provide the Prism Central or Prism Element address and the number of clusters.", whyRelevant: "Certero has a native Nutanix connector that discovers VMs, hosts and clusters via the Prism REST API.", exampleResponse: "Prism Central: prism.anyco.local, 3 clusters, ~200 VMs", scope: "both", isNew: true, inputType: "textarea", techGroup: "nutanix" },
        { ref: "1.5.5", text: "Can you provide a read-only Prism user account for the Nutanix connector?", whyRelevant: "The connector requires a user with Viewer role to read cluster, host and VM data.", exampleResponse: "Yes, we will create a read-only Prism user", scope: "both", isNew: true, inputType: "textarea", techGroup: "nutanix" },
        { ref: "1.5.6", text: "Please provide the pool master FQDN and IP address for each XenServer pool.", whyRelevant: "Certero has a native XenServer connector that discovers hosts and VMs via the XAPI.", exampleResponse: "xenpool01.anyco.local (10.0.3.10)\nxenpool02.anyco.local (10.0.4.10)", scope: "both", isNew: true, inputType: "textarea", techGroup: "xenserver" },
        { ref: "1.5.7", text: "Please provide the oVirt Engine / RHV Manager URL.", whyRelevant: "Certero has a native oVirt/RHV connector that discovers datacenters, clusters, hosts and VMs via the oVirt REST API.", exampleResponse: "https://ovirt-engine.anyco.local/ovirt-engine/api", scope: "both", isNew: true, inputType: "textarea", techGroup: "ovirt" },
        { ref: "1.5.8", text: "Can you provide a read-only user account for the oVirt REST API?", whyRelevant: "The connector requires API credentials to read virtualization data.", exampleResponse: "Yes, we will create a read-only oVirt user", scope: "both", isNew: true, inputType: "textarea", techGroup: "ovirt" },
        { ref: "1.5.9", text: "Please provide the FQDN and IP address of each Oracle VM Manager.", whyRelevant: "Certero has a native Oracle VM connector that discovers server pools, servers and VMs via the OVM Manager REST API.", exampleResponse: "ovm-manager.anyco.local (10.0.5.10)", scope: "both", isNew: true, inputType: "textarea", techGroup: "oraclevm" },
        { ref: "1.5.10", text: "Please provide the names and IP addresses of each IBM Hardware Management Console (HMC).", whyRelevant: "The solution connects to each HMC to discover managed systems, LPARs and processor allocations. We will require a user account with the 'hmcviewer' task role.", exampleResponse: "hmc01.anyco.local (10.0.6.1)\nhmc02.anyco.local (10.0.6.2)", scope: "both", isNew: true, inputType: "textarea", techGroup: "ibmhmc" },
        { ref: "1.5.11", text: "How many managed systems (frames) are connected to each HMC?", whyRelevant: "Helps scope the IBM PowerVM connector configuration and understand the LPAR landscape for PVU licence calculations.", exampleResponse: "HMC1: 4 Power8 frames\nHMC2: 2 Power9 frames", scope: "both", isNew: true, inputType: "textarea", techGroup: "ibmhmc" },
        { ref: "1.5.12", text: "Please provide the FQDN or IP address of each Hyper-V host or System Center Virtual Machine Manager (SCVMM).", whyRelevant: "Certero can discover Hyper-V VMs and hosts via WMI or SCVMM.", exampleResponse: "scvmm01.anyco.local (10.0.7.10)\nhyperv01.anyco.local\nhyperv02.anyco.local", scope: "both", isNew: true, inputType: "textarea", techGroup: "hyperv" }
      ]
    },
    {
      id: "1.6", title: "Network Infrastructure", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.6.1", text: "Approximately how many network subnets do you have?", whyRelevant: "To provide an understanding of your network structure.", exampleResponse: "125", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.6.2", text: "Provide details of any internal networks or VLANs that are firewalled, for example, connectivity across the networks is blocked for default ports.", whyRelevant: "To provide an understanding of your network structure in terms of any environments that have restricted network access for which additional firewall ports may need to be opened.", exampleResponse: "Network Name: DMZ\nNetwork: 10.17.21.0\nSubnet Mask: 255.255.255.0\nRestrictions: All inbound traffic blocked, exceptions managed by firewall rule", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.6.3", text: "Please provide a contact for Network infrastructure planning and changes.", whyRelevant: "Someone who knows the network architecture and can ensure any required network changes are managed and executed.", exampleResponse: "John Smith, Network Administrator, john.smith@anyco.com, Tel: (555) 123 4567", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.6.4", text: "For Unix and Linux based computers, the solution uses TCP port 22 for Network Discovery. Please confirm the port (or ports) to be used.", whyRelevant: "To allow Network Discovery of Unix and Linux computers.", exampleResponse: "Port 22 is fine", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.6.5", text: "Do you have SNMP-manageable network devices (switches, routers, printers, UPS, etc.)? If so, approximately how many?", whyRelevant: "Certero can discover and inventory SNMP-enabled network devices to provide complete visibility.", exampleResponse: "Yes, approximately 500 managed switches and 50 routers", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "1.7", title: "Information Security", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.7.1", text: "Do you have any legacy Windows Servers & Desktops? (Windows 2003, XP, 2008, 2003)", whyRelevant: "These legacy systems impact the SSL Certificate requirement. Checking your Active Directory for older legacy Windows systems will help answer this question.", exampleResponse: "No", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No", "Unknown"] },
        { ref: "1.7.2", text: "Please confirm you are able to provide SSL Certificates.", whyRelevant: "Without valid SSL Certificates, the solution will not be able to securely communicate over HTTPS.", exampleResponse: "Yes, certificates are issued by our internal CA.", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "1.8", title: "Patch Management", category: "about-you",
      scope: "both", conditional: true, conditionalLabel: "Patch Management in scope",
      questions: [
        { ref: "1.8.1", text: "What patch management tools do you currently use for Windows systems?", whyRelevant: "Understanding existing patch management infrastructure helps plan the Certero Patch Management module integration.", exampleResponse: "WSUS and SCCM for Windows patching, manual process for Linux", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "1.8.2", text: "How many WSUS servers do you have and what are their FQDNs?", whyRelevant: "Required to configure the Certero Patch Management connector to synchronize with your WSUS infrastructure.", exampleResponse: "2 servers: wsus01.anyco.local, wsus02.anyco.local", scope: "onprem", isNew: true, inputType: "textarea" },
        { ref: "1.8.3", text: "Do you have a defined patch cycle (e.g. monthly Patch Tuesday, quarterly)?", whyRelevant: "Helps align Certero patch reporting schedules with your existing patch windows.", exampleResponse: "Monthly, aligned with Microsoft Patch Tuesday + 7 days for testing", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "1.8.4", text: "Do you patch Linux/Unix systems? If so, what tools and repositories are used?", whyRelevant: "Understanding Linux patch infrastructure helps plan comprehensive patch visibility.", exampleResponse: "Yes, using Ansible with local RHEL Satellite repositories", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "1.9", title: "Input into Project Planning", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "1.9.1", text: "Will you be assigning a Project Manager to the Implementation and Configuration and if so, can you provide their contact details?", whyRelevant: "So we know if you will have a Project Manager in place and who to liaise with.", exampleResponse: "John Smith, Project Manager, john.smith@anyco.com, Tel: (555) 123 4567", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.2", text: "Please provide an escalation point for the project.", whyRelevant: "If any issues need escalating, we will have a contact for communication.", exampleResponse: "John Smith, Program Manager, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.3", text: "Will any members of the Certero delivery team need to go through any security clearance processes before starting the project?", whyRelevant: "To understand if this will be a prerequisite before activities can commence.", exampleResponse: "No special security clearances required", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No", "Unsure"] },
        { ref: "1.9.4", text: "What is the lead time for a change request to be approved?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "7 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.9.5", text: "Which day of the week is the deadline for submitting change requests?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "Wednesday of each week", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.9.6", text: "When are your planned change freeze dates?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "Public Holiday: 25-Jun-2025\nEaster\nChristmas period (Dec 20 - Jan 2)", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.7", text: "Are there any internal deadlines you are working towards that we need to be aware of?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "We have a Microsoft EA renewal due 25-Jun-2025", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.8", text: "Are there any other priority projects that could impact the Certero delivery that should be considered?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "Project 'Secret Squirrel' that completes in 4 weeks will require the same resources", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.9", text: "Is any of your IT outsourced, and if so, which parts?", whyRelevant: "To help understand if your team needs to interact with a 3rd party organization.", exampleResponse: "Yes. Our IBM servers are managed by AnyCo Server Management Inc.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.10", text: "Do you have any parts of the business that fall under different management?", whyRelevant: "To help us understand if we need to engage multiple teams for the project.", exampleResponse: "Yes. Our business unit in France is managed separately.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.11", text: "What time zones do your teams operate in?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "EST & GMT", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.9.12", text: "Provide up to two currencies you would like to use with the solution, confirming which is to be used as your primary currency.", whyRelevant: "To help define one or more currencies within the solution as part of its implementation.", exampleResponse: "US$ (Primary currency) and GBP", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.9.13", text: "The solution has the ability to highlight any new computers found on your network for a number of days - how many days should this be?", whyRelevant: "To be used during the configuration of the solution.", exampleResponse: "7 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.9.14", text: "The solution has the ability to highlight 'expired' computers, which are those not seen by the solution after a number of days - how many days should this be?", whyRelevant: "To be used during the configuration of the solution.", exampleResponse: "30 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.9.15", text: "The solution has the ability to auto-archive computers not seen by the solution after a pre-defined number of days - how many days should this be?", whyRelevant: "To be used during the configuration of the solution.", exampleResponse: "90 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "1.9.16", text: "Who do you see as being the main user(s) of the solution? For each, provide their full name, their role and the login username to be used.", whyRelevant: "This will help with the setting up of the initial users of the solution.", exampleResponse: "John Smith, Software Asset Manager, jsmith01\nJohn Appleseed, Desktop Engineer, jappleseed02", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "1.9.17", text: "For the main solution users identified above, which authentication method do you wish to use?", whyRelevant: "This will help with the setting up of the initial users of the solution.", exampleResponse: "Azure Active Directory", scope: "both", isNew: false, inputType: "select", options: ["Local account within the solution", "On-premise Active Directory", "Azure Active Directory", "Federated Active Directory"] }
      ]
    },

    /* ─── 2.x ABOUT THE SOLUTION ─── */
    {
      id: "2.1", title: "Application Server", category: "about-solution",
      scope: "onprem", conditional: false,
      questions: [
        { ref: "2.1.1", text: "The solution will have an Application Server. Please provide a static IPv4 address.", whyRelevant: "The IP address will need to be added to DNS.", exampleResponse: "192.168.10.22", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "2.1.2", text: "Please provide a FQDN or alias that you would like to use for the main solution website.", whyRelevant: "This will be used by users to access the solution from their browser and needs to be added to DNS.", exampleResponse: "certero.anyco.local", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "2.1.3", text: "On the Application Server there will be a secondary website for Certero Provisioning. What should the site name be?", whyRelevant: "This will be used in conjunction with the port number to access the Certero Provisioning website.", exampleResponse: "certeroprov.anyco.local", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "2.1.4", text: "A secondary website (Certero Provisioning) on the Application Server uses port 9000 by default for access. If this is not acceptable, which other port should be used?", whyRelevant: "Needed as part of the installation of Certero Provisioning on the Application Server so its website can be accessed.", exampleResponse: "Port 9000 is fine to use on the Application Server", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "2.1.5", text: "Please provide the email address and the name of an individual who should have access to Certero Provisioning.", whyRelevant: "This user will be set up as your initial user of Certero Provisioning.", exampleResponse: "john.smith@anyco.com, John Smith", scope: "onprem", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "2.2", title: "Database Server", category: "about-solution",
      scope: "onprem", conditional: false,
      questions: [
        { ref: "2.2.1", text: "The Database uses Microsoft SQL Server. The supported versions are Microsoft SQL Server 2016 or greater, Standard or Enterprise Edition. What version and edition of Microsoft SQL Server will be used?", whyRelevant: "Will be incorporated into the solution design and any related prerequisites.", exampleResponse: "2019 Standard Edition", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "2.2.2", text: "Certero recommends that a dedicated instance of SQL Server is used to support Certero. Will the SQL Server be a shared or dedicated instance?", whyRelevant: "Will be incorporated into the solution design and any related prerequisites.", exampleResponse: "Dedicated", scope: "onprem", isNew: false, inputType: "select", options: ["Dedicated (recommended)", "Shared"] },
        { ref: "2.2.3", text: "SQL Server and the Application Server must be members of the same Active Directory Domain. Which domain will this be?", whyRelevant: "To ensure the two solution components can communicate.", exampleResponse: "Both will be on AD domain ANYCO", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "2.2.4", text: "For SQL Server will you use a Default Instance, or a Named Instance?", whyRelevant: "Will be incorporated into the solution design and any related prerequisites.", exampleResponse: "Named Instance", scope: "onprem", isNew: false, inputType: "select", options: ["Default Instance", "Named Instance"] },
        { ref: "2.2.5", text: "If you use a Named Instance, then please confirm the dynamic port range that will be used.", whyRelevant: "SQL Server may be configured to use Dynamic Ports. If this is the case, a range of ports will need to be opened.", exampleResponse: "Ports 45200 to 45250", scope: "onprem", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "2.3", title: "Certero Client Agent", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "2.3.1", text: "Please confirm your preference to use agent-based or agentless inventory of your Windows workstations.", whyRelevant: "To help configure inventory within the solution aligned to your preference.", exampleResponse: "Agent-based", scope: "both", isNew: false, inputType: "select", options: ["Agent-based", "Agentless", "Both"] },
        { ref: "2.3.2", text: "Please confirm your preference to use agent-based or agentless inventory of your Windows servers.", whyRelevant: "To help configure inventory within the solution aligned to your preference.", exampleResponse: "Agentless", scope: "both", isNew: false, inputType: "select", options: ["Agent-based", "Agentless", "Both"] },
        { ref: "2.3.3", text: "For those computers having the Certero Client Agent installed, it can be configured to show or hide its icon in the system tray area. Do you want this to be shown or hidden to end users?", whyRelevant: "Will be incorporated into the solution design.", exampleResponse: "Show", scope: "both", isNew: false, inputType: "select", options: ["Show", "Hide"] },
        { ref: "2.3.4", text: "The Client Agent has an auto-update capability for ease of on-going operational maintenance. Should this capability be enabled or disabled?", whyRelevant: "Will be incorporated into the solution design.", exampleResponse: "Enable", scope: "both", isNew: false, inputType: "select", options: ["Enable", "Disable"] },
        { ref: "2.3.5", text: "The Client Agent can run a small web server on each endpoint computer to help diagnose and troubleshoot issues. Please confirm if this is a capability you wish to enable, and if so, which unique port to use and whether HTTP or HTTPS should be used.", whyRelevant: "This allows users of the solution to look at Certero log files on the computer where the Client Agent is installed and make use of optional plug-in tools.", exampleResponse: "HTTPS, port 27738", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "2.3.6", text: "For this Implementation & Configuration of the solution, the Client Agent will be deployed to a sample of up to 10 workstations. Please provide a list of the FQDNs of these sample workstations.", whyRelevant: "The list of these workstations will be used during the implementation to confirm the operability of the Certero Client Agent.", exampleResponse: "workstation01.anyco.local\nworkstation02.anyco.local\nworkstation03.anyco.local", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "2.4", title: "Networks", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "2.4.1", text: "Please provide a list of networks by completing the Network Definitions Template (or provide equivalent information):\n- Network Name\n- Network Address\n- Subnet Mask\n- Location\n- Description", whyRelevant: "This will be used to import your network definitions into the solution and enable asset Discovery to occur.", exampleResponse: "See attached Network Definitions spreadsheet, covering 125 subnets across all locations.", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "2.5", title: "Information Security", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "2.5.1", text: "Will you be using Anti-Virus software on the Application Server, Database Server and/or Endpoint Server solution components?", whyRelevant: "If Anti-Virus is used, best practice is to add exceptions so as to not impact performance of the solution.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No", "Unsure"] },
        { ref: "2.5.2", text: "Do you use a proxy server to access the internet?", whyRelevant: "Proxy server details will be required for Certero Provisioning to correctly synchronize with the Customer Centre.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No"] },
        { ref: "2.5.3", text: "Certero Provisioning on the Application Server can 'pull' updates such as SRDB definitions automatically securely over the internet using HTTPS port 443. This will be enabled by default. Please confirm this is acceptable.", whyRelevant: "To allow Certero Provisioning to communicate with the Certero Customer Center (cc.certero.com) to receive License Activations, download new releases and enable automatic SRDB synchronization.", exampleResponse: "OK", scope: "both", isNew: false, inputType: "select", options: ["Yes, acceptable", "No, not acceptable"] },
        { ref: "2.5.4", text: "Within your network, secure HTTPS traffic between solution components uses port 443. If this is not the port you use, which other port should be used for HTTPS?", whyRelevant: "To ensure the secure communication between all solution components over HTTPS.", exampleResponse: "Yes, use port 443", scope: "both", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "2.6", title: "Email & Alerting", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "2.6.1", text: "What is the SMTP email relay server name the solution can use?", whyRelevant: "Used to allow the Certero solution to send emails to its users such as reports and automated alerts.", exampleResponse: "smtp.office365.com (Office 365) or smtp01.anyco.com (On-premise)", scope: "both", isNew: false, inputType: "text" },
        { ref: "2.6.2", text: "The typical ports for an SMTP server will be 587 or 25. Please confirm which port should be used.", whyRelevant: "Used to allow the Certero solution to send emails to its users.", exampleResponse: "Port 587 (Office 365) or Port 25 (On-premise)", scope: "both", isNew: false, inputType: "select", options: ["587", "25", "Other"] },
        { ref: "2.6.3", text: "What authentication type is used with the SMTP Email server: Anonymous or Basic?", whyRelevant: "To know which method of authentication is to be used and if credentials are to be provided.", exampleResponse: "Basic", scope: "both", isNew: false, inputType: "select", options: ["Anonymous", "Basic"] },
        { ref: "2.6.4", text: "For emailed alerts from the solution, confirm the 'sender' email address and the name you wish to use.", whyRelevant: "Emails from the solution will be sent from the sender email address and name provided.", exampleResponse: "noreply@certero.anyco.com, Certero Platform", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "2.6.5", text: "Does your SMTP email relay server require the sending server to be 'approved' or on a 'whitelist' to allow the solution to make use of it?", whyRelevant: "This may be required before the solution can send emails and alerts using your email infrastructure.", exampleResponse: "Yes, the solution will need to be added to an approved list of senders.", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No", "Unsure"] }
      ]
    },
    {
      id: "2.7", title: "Certero Customer Centre", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "2.7.1", text: "Provide email address, name, primary telephone number and (optionally) a secondary telephone number for each Technical Contact requiring access to the Certero Customer Centre.", whyRelevant: "The user accounts for these Technical Contacts (as defined within the Technical Support Policy) will be created.", exampleResponse: "John Smith, john.smith@anyco.com, (555) 123 4567\nJohn Appleseed, john.appleseed@anyco.com, (555) 765 4321", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "2.8", title: "Distribution", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Distribution in scope",
      questions: [
        { ref: "2.8.1", text: "Do you use SCCM/MECM for software distribution? If so, please provide the SCCM server FQDN.", whyRelevant: "The Certero Distribution connector integrates with SCCM to provide software distribution capabilities.", exampleResponse: "Yes, sccm01.anyco.local", scope: "onprem", isNew: false, inputType: "textarea" },
        { ref: "2.8.2", text: "What other software distribution tools do you use (e.g. Intune, BigFix, PDQ Deploy)?", whyRelevant: "Understanding your distribution landscape helps plan the integration approach.", exampleResponse: "BigFix for servers, Intune for cloud-managed workstations", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "2.9", title: "Application Monitoring", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Application Monitoring in scope",
      questions: [
        { ref: "2.9.1", text: "By default, the Application Monitoring module will be enabled on all workstations. Confirm if there are to be any exceptions to this approach, and what they are.", whyRelevant: "This will be taken into consideration as part of the implementation and configuration of the solution.", exampleResponse: "No exceptions - deploy to all user workstations", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "2.9.2", text: "Are there specific applications you want to prioritize for monitoring (e.g. high-cost software, security-critical applications)?", whyRelevant: "Helps focus the Application Monitoring configuration on the most valuable targets.", exampleResponse: "Microsoft Office, Adobe Creative Cloud, AutoCAD, MATLAB", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "2.10", title: "Patch Management", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Patch Management in scope",
      questions: [
        { ref: "2.10.1", text: "Do you want Certero to provide patch compliance reporting across your Windows estate?", whyRelevant: "Certero Patch Management provides visibility into patch compliance status across all managed Windows systems.", exampleResponse: "Yes, we need compliance reporting for audit purposes", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "2.10.2", text: "If On-Prem: Please provide the FQDN(s) of your WSUS server(s) for patch synchronization.", whyRelevant: "Required to configure the Certero Patch Management integration with your WSUS infrastructure.", exampleResponse: "wsus01.anyco.local, wsus02.anyco.local", scope: "onprem", isNew: false, inputType: "textarea" },
        { ref: "2.10.3", text: "Do you require patch compliance data to be integrated with any other tools or dashboards?", whyRelevant: "Understanding downstream reporting requirements helps plan the implementation.", exampleResponse: "Yes, we export patch compliance data into ServiceNow monthly", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "2.11", title: "SNMP Network Discovery", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "SNMP Discovery in scope",
      questions: [
        { ref: "2.11.1", text: "Do you want to use SNMP-based network discovery to find and inventory network devices (switches, routers, printers, etc.)?", whyRelevant: "Certero supports SNMP v1/v2c/v3 for discovering and inventorying network infrastructure devices.", exampleResponse: "Yes, we want to discover all managed switches and routers", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.11.2", text: "Which SNMP version(s) do you use: v1, v2c, or v3?", whyRelevant: "Different SNMP versions require different configuration (community strings for v1/v2c, credentials for v3).", exampleResponse: "SNMP v2c for most devices, v3 for core switches", scope: "both", isNew: true, inputType: "text" },
        { ref: "2.11.3", text: "If using SNMP v1/v2c, what community string(s) are configured on your network devices?", whyRelevant: "Community strings are required for the SNMP connector to authenticate with network devices.", exampleResponse: "Read-only community string: 'public' (we will change this before go-live)", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.11.4", text: "If using SNMP v3, please provide the authentication and privacy details:\n- Username\n- Authentication protocol (MD5/SHA)\n- Privacy protocol (DES/AES)", whyRelevant: "SNMP v3 requires authentication credentials for secure device access.", exampleResponse: "Username: certero-ro\nAuth: SHA\nPrivacy: AES128", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.11.5", text: "Which network ranges should be scanned for SNMP-enabled devices?", whyRelevant: "Defines the scope of SNMP network discovery to target the correct network segments.", exampleResponse: "10.0.0.0/16 (management VLAN)\n172.16.0.0/12 (infrastructure VLAN)", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "2.12", title: "Microsoft Intune", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Intune connector in scope",
      hasTechSelector: true,
      techOptions: [
        { key: "intune", label: "Yes, we use Microsoft Intune" }
      ],
      questions: [
        { ref: "2.12.1", text: "Approximately how many devices are enrolled in Intune?", whyRelevant: "The Intune connector imports managed device data to provide visibility of cloud-managed endpoints.", exampleResponse: "Approximately 5,000 Windows devices and 2,000 mobile devices enrolled", scope: "both", isNew: true, inputType: "textarea", techGroup: "intune" },
        { ref: "2.12.2", text: "Can you provide an App Registration in Azure AD with the Microsoft Graph API permissions required for Intune device read access?", whyRelevant: "The Intune connector uses Microsoft Graph API to read device and compliance data.", exampleResponse: "Yes, we will create an App Registration with DeviceManagementManagedDevices.Read.All permission", scope: "both", isNew: true, inputType: "textarea", techGroup: "intune" },
        { ref: "2.12.3", text: "Do you manage both corporate-owned and BYOD devices through Intune?", whyRelevant: "Helps configure the connector to correctly categorize device ownership types.", exampleResponse: "Yes, corporate-owned laptops and BYOD mobile devices", scope: "both", isNew: true, inputType: "textarea", techGroup: "intune" }
      ]
    },
    {
      id: "2.13", title: "Cisco Meraki", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Cisco Meraki connector in scope",
      hasTechSelector: true,
      techOptions: [
        { key: "meraki", label: "Yes, we use Cisco Meraki" }
      ],
      questions: [
        { ref: "2.13.1", text: "How many Meraki networks/sites are managed?", whyRelevant: "The Cisco Meraki connector discovers and inventories network devices managed through the Meraki Dashboard.", exampleResponse: "25 sites managed through Meraki Dashboard", scope: "both", isNew: true, inputType: "textarea", techGroup: "meraki" },
        { ref: "2.13.2", text: "Can you provide a Meraki Dashboard API key with read-only organization access?", whyRelevant: "The connector uses the Meraki Dashboard REST API to collect network and device data.", exampleResponse: "Yes, we will generate an API key from the Meraki Dashboard", scope: "both", isNew: true, inputType: "textarea", techGroup: "meraki" },
        { ref: "2.13.3", text: "Which Meraki product types are in use (MX, MS, MR, MV, MT)?", whyRelevant: "Helps scope the connector to collect data for the relevant Meraki product families.", exampleResponse: "MX (security appliances), MS (switches), MR (wireless APs)", scope: "both", isNew: true, inputType: "textarea", techGroup: "meraki" }
      ]
    },
    {
      id: "2.14", title: "ServiceNow Integration", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "ServiceNow integration in scope",
      hasTechSelector: true,
      techOptions: [
        { key: "servicenow", label: "Yes, we use ServiceNow" }
      ],
      questions: [
        { ref: "2.14.1", text: "Which ServiceNow version and instance URL do you use?", whyRelevant: "Certero can integrate with ServiceNow to synchronize asset data, CMDB records, and licence compliance information.", exampleResponse: "San Diego release, https://anyco.service-now.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "servicenow" },
        { ref: "2.14.2", text: "What is the intended direction of data flow? (Certero to ServiceNow, ServiceNow to Certero, or bidirectional)", whyRelevant: "Determines the integration approach and required ServiceNow API permissions.", exampleResponse: "Certero to ServiceNow - push asset and licence data to populate the CMDB", scope: "both", isNew: true, inputType: "textarea", techGroup: "servicenow" },
        { ref: "2.14.3", text: "Can you provide a ServiceNow service account with the appropriate roles for API access?", whyRelevant: "The integration requires API access to read/write ServiceNow tables (e.g. cmdb_ci, alm_asset).", exampleResponse: "Yes, we will create a service account with ITAM roles", scope: "both", isNew: true, inputType: "textarea", techGroup: "servicenow" },
        { ref: "2.14.4", text: "Which ServiceNow tables/modules do you want to integrate with (CMDB, SAM, HAM, ITSM)?", whyRelevant: "Helps scope the integration to the relevant ServiceNow modules.", exampleResponse: "CMDB for asset records, SAM Pro for licence compliance", scope: "both", isNew: true, inputType: "textarea", techGroup: "servicenow" }
      ]
    },
    {
      id: "2.15", title: "Warranty", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "2.15.1", text: "Do you wish to make use of the Dell Warranty information automatically collected by the solution?", whyRelevant: "The solution can contact Dell systems over the internet to obtain specific warranty information regarding Dell computers.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "select", options: ["Yes", "No"] },
        { ref: "2.15.2", text: "If enabling Dell warranty lookups, can you provide a Dell TechDirect API key?", whyRelevant: "Dell requires API credentials for automated warranty lookups. A TechDirect account with API access is needed.", exampleResponse: "Yes, we have a Dell TechDirect account and can generate API credentials", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.15.3", text: "Do you wish to enable Lenovo warranty lookups?", whyRelevant: "The solution can also collect warranty data for Lenovo devices via the Lenovo support API.", exampleResponse: "Yes, we have approximately 2,000 Lenovo devices", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.15.4", text: "If enabling Lenovo warranty lookups, can you provide Lenovo API credentials?", whyRelevant: "Lenovo warranty lookups require valid API credentials from the Lenovo support portal.", exampleResponse: "Yes, we will request API credentials from Lenovo", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    /* ─── PRODUCT-SPECIFIC SECTIONS ─── */

    {
      id: "2.16", title: "App-Centre", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "App-Centre module in scope",
      questions: [
        { ref: "2.16.1", text: "Please provide a contact for creating and testing App-Centre packages and applications.", whyRelevant: "A dedicated contact is needed for the packaging workshop and testing phases of the App-Centre implementation.", exampleResponse: "Jane Smith, jane.smith@anyco.com, +44 7700 900123", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.2", text: "Do you currently use Microsoft System Centre (SCCM/MECM) for software distribution? If so, are you looking to integrate it with App-Centre?", whyRelevant: "App-Centre can integrate with SCCM to manage the deployment of packages and applications via existing SCCM infrastructure.", exampleResponse: "Yes, we use SCCM 2309 and want to integrate for software deployment", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.3", text: "Where SCCM integration is required, please provide a contact for SCCM planning and changes.", whyRelevant: "SCCM integration requires coordination with the SCCM administrator for configuration changes.", exampleResponse: "Bob Jones, SCCM Admin, bob.jones@anyco.com", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.4", text: "If you are integrating with SCCM, please provide the FQDN of the SCCM Server along with the version.", whyRelevant: "Required for configuring the SCCM integration endpoint.", exampleResponse: "sccm01.anyco.local, SCCM 2309 (ConfigMgr)", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.5", text: "Software delivery via Certero Distribution requires a central repository to store software delivery files. Do you have an existing network share for this purpose, or would you like to use one of the Certero servers?", whyRelevant: "A UNC-accessible file share is required for storing software packages that will be deployed via App-Centre.", exampleResponse: "We have an existing share: \\\\fileserver01\\SoftwareRepo", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.6", text: "Where using an existing software repository, please provide the FQDN and file share path to be used.", whyRelevant: "The exact UNC path is needed to configure App-Centre's software source location.", exampleResponse: "\\\\fileserver01.anyco.local\\SoftwareRepo\\AppCentre", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.7", text: "Please prepare a user credential with read-only access to the software repository UNC path.", whyRelevant: "The Certero application server needs credentials to access the software repository for package distribution.", exampleResponse: "Service account: svc-appcentre-ro@anyco.com (read-only access to the share)", scope: "onprem", isNew: true, inputType: "textarea" },
        { ref: "2.16.8", text: "Please confirm if any additional network firewall rules need to be implemented to enable all App-Centre clients to connect using TCP Ports 135 and 445.", whyRelevant: "App-Centre software delivery uses SMB (TCP 445) and RPC (TCP 135) for package distribution to endpoints.", exampleResponse: "Firewall rules already permit TCP 135 and 445 from workstation VLANs to the file server", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.9", text: "Do you wish to customize the App-Centre user interface with your own branding (logo, colours)?", whyRelevant: "App-Centre supports custom branding for the end-user self-service portal.", exampleResponse: "Yes, we will provide our corporate logo and brand colour codes", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.10", text: "Will you be using App-Centre for Windows desktops and/or servers?", whyRelevant: "Determines which device types need the App-Centre agent component and configuration.", exampleResponse: "Windows desktops only (laptops and VDI), not servers", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.16.11", text: "Will you be using App-Centre for macOS devices?", whyRelevant: "macOS App-Centre requires a different agent package and deployment approach.", exampleResponse: "Yes, we have approximately 200 macOS devices that need App-Centre", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },

    {
      id: "2.17", title: "Enterprise SAM", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Enterprise SAM (C4ESAM) module in scope",
      questions: [
        { ref: "2.17.1", text: "Who is the person responsible for Software Asset Management (SAM) within your organisation?", whyRelevant: "The SAM owner is a key stakeholder for the implementation and will drive adoption of the solution.", exampleResponse: "Sarah Williams, SAM Manager, sarah.williams@anyco.com", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.17.2", text: "By default, the Access Control module will be enabled on all workstations. Confirm if there are to be any exceptions to this approach, and what they are.", whyRelevant: "Access Control manages software entitlements on endpoints. Some workstation groups may need to be excluded.", exampleResponse: "Exclude developer workstations (they need unrestricted software access)", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },

    {
      id: "2.18", title: "Certero for IBM", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Certero for IBM (C4IBM) module in scope",
      hasTechSelector: true,
      techOptions: [
        { key: "solaris", label: "Solaris" },
        { key: "hpux", label: "HP-UX" },
        { key: "aix", label: "AIX" },
        { key: "subcap", label: "IBM Sub-Capacity (PVU/ILMT)" },
        { key: "powervm", label: "IBM PowerVM (HMC)" }
      ],
      questions: [
        { ref: "2.18.1", text: "Can you provide an SSH key (RSA key pair) for non-Windows system authentication (AIX, Solaris, HP-UX, Linux)?", whyRelevant: "SSH key-based authentication is the preferred method for connecting to Unix/Linux systems for inventory collection.", exampleResponse: "Yes, we will generate an RSA key pair and deploy the public key to target systems", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.18.2", text: "How many Solaris systems do you have?", whyRelevant: "Determines the scope of Solaris inventory and licensing compliance analysis.", exampleResponse: "75 (41 Corporate, 34 AOD)", scope: "both", isNew: true, inputType: "textarea", techGroup: "solaris" },
        { ref: "2.18.3", text: "Please provide a technical contact for your Solaris systems.", whyRelevant: "A technical contact is needed for planning SSH access and inventory agent deployment on Solaris.", exampleResponse: "Mike Chen, Unix Admin, mike.chen@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "solaris" },
        { ref: "2.18.4", text: "Please provide a sample Solaris system FQDN and IP address for connectivity testing.", whyRelevant: "A sample system is used to validate SSH connectivity and inventory collection before rolling out to all Solaris systems.", exampleResponse: "solaris01.anyco.local, 10.20.30.40", scope: "both", isNew: true, inputType: "textarea", techGroup: "solaris" },
        { ref: "2.18.5", text: "How many HP-UX systems do you have?", whyRelevant: "Determines the scope of HP-UX inventory and licensing compliance analysis.", exampleResponse: "12", scope: "both", isNew: true, inputType: "textarea", techGroup: "hpux" },
        { ref: "2.18.6", text: "Please provide a technical contact for your HP-UX systems.", whyRelevant: "A technical contact is needed for planning SSH access and inventory collection on HP-UX.", exampleResponse: "Lisa Park, Unix Admin, lisa.park@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "hpux" },
        { ref: "2.18.7", text: "Please provide a sample HP-UX system FQDN and IP address for connectivity testing.", whyRelevant: "A sample system is used to validate SSH connectivity and inventory collection before rolling out to all HP-UX systems.", exampleResponse: "hpux01.anyco.local, 10.20.30.50", scope: "both", isNew: true, inputType: "textarea", techGroup: "hpux" },
        { ref: "2.18.8", text: "How many AIX systems do you have?", whyRelevant: "Determines the scope of AIX inventory and IBM PVU licensing compliance analysis.", exampleResponse: "267 (107 AOD, 160 Corporate)", scope: "both", isNew: true, inputType: "textarea", techGroup: "aix" },
        { ref: "2.18.9", text: "Please provide a technical contact for your AIX systems.", whyRelevant: "A technical contact is needed for planning SSH access and inventory collection on AIX.", exampleResponse: "Tom Wilson, AIX Admin, tom.wilson@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "aix" },
        { ref: "2.18.10", text: "Please provide a sample AIX system FQDN and IP address for connectivity testing.", whyRelevant: "A sample system is used to validate SSH connectivity and inventory collection before rolling out to all AIX systems.", exampleResponse: "aix01.anyco.local, 10.20.30.60", scope: "both", isNew: true, inputType: "textarea", techGroup: "aix" },
        { ref: "2.18.11", text: "Are IBM products licensed under Sub-Capacity (Processor Value Unit / PVU)?", whyRelevant: "Sub-capacity licensing requires specific data collection from ILMT and virtualization infrastructure for compliance.", exampleResponse: "Yes, we use PVU sub-capacity licensing for WebSphere, MQ, and DB2", scope: "both", isNew: true, inputType: "textarea", techGroup: "subcap" },
        { ref: "2.18.12", text: "Do you use IBM License Metric Tool (ILMT) for sub-capacity reporting?", whyRelevant: "ILMT is required by IBM for sub-capacity PVU licensing compliance. The connector imports data from ILMT.", exampleResponse: "Yes, ILMT version 9.2.28", scope: "both", isNew: true, inputType: "textarea", techGroup: "subcap" },
        { ref: "2.18.13", text: "Is ILMT running on Linux with DB2?", whyRelevant: "CRITICAL: If ILMT uses DB2, a FULL DB2 licence must have been purchased. The runtime licence included with ILMT does NOT allow outbound connections. Using it for the Certero connector violates the IBM licence agreement.", exampleResponse: "Yes, ILMT runs on RHEL 8 with DB2 11.5", scope: "both", isNew: true, inputType: "select", options: ["Yes", "No", "N/A"], techGroup: "subcap" },
        { ref: "2.18.14", text: "Is ILMT running on Windows with SQL Server?", whyRelevant: "ILMT on Windows with SQL Server avoids the DB2 licensing concern and is the recommended configuration for the connector.", exampleResponse: "No, it runs on Linux with DB2", scope: "both", isNew: true, inputType: "select", options: ["Yes", "No", "N/A"], techGroup: "subcap" },
        { ref: "2.18.15", text: "Please provide a technical contact for ILMT.", whyRelevant: "Required for configuring the ILMT connector and setting up database access.", exampleResponse: "Dave Brown, ILMT Admin, dave.brown@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "subcap" },
        { ref: "2.18.16", text: "Please provide the names of each ILMT Server.", whyRelevant: "Required for configuring the ILMT connector endpoint(s).", exampleResponse: "ilmt01.anyco.local\nilmt02.anyco.local", scope: "both", isNew: true, inputType: "textarea", techGroup: "subcap" },
        { ref: "2.18.17", text: "Do you use IBM PowerVM (AIX) virtualisation?", whyRelevant: "PowerVM data from the HMC is critical for IBM PVU licence compliance calculations.", exampleResponse: "Yes, we have 15 HMC-managed Power Systems frames", scope: "both", isNew: true, inputType: "textarea", techGroup: "powervm" },
        { ref: "2.18.18", text: "Please provide the names of each IBM Hardware Management Console (HMC).", whyRelevant: "Each HMC needs a connector configured with an account that has the 'hmcviewer' task role.", exampleResponse: "hmc01.anyco.local\nhmc02.anyco.local\nhmc03.anyco.local", scope: "both", isNew: true, inputType: "textarea", techGroup: "powervm" },
        { ref: "2.18.19", text: "Please confirm you can provide a user account with the 'hmcviewer' task role on each HMC.", whyRelevant: "The HMC connector requires an account with the 'hmcviewer' role to read managed system, LPAR, and processor data.", exampleResponse: "Yes, we will create a dedicated hmcviewer account on each HMC", scope: "both", isNew: true, inputType: "textarea", techGroup: "powervm" }
      ]
    },

    {
      id: "2.19", title: "Certero for Oracle", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Certero for Oracle (C4O) module in scope",
      hasTechSelector: true,
      techOptions: [
        { key: "oradb", label: "Oracle Database" },
        { key: "oramw", label: "Oracle Middleware" },
        { key: "oraebs", label: "Oracle E-Business Suite" }
      ],
      questions: [
        { ref: "2.19.1", text: "Are all of your Oracle Database environments managed by a single team?", whyRelevant: "Multiple teams managing Oracle databases may require separate project workstreams and coordination.", exampleResponse: "No, we have a central DBA team for production and separate teams for development environments", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.2", text: "Please provide technical contacts of those who understand your Oracle Database environments.", whyRelevant: "Technical contacts are needed for configuring database connectivity and validating inventory data.", exampleResponse: "Production: John Smith, john.smith@anyco.com\nDevelopment: Jane Doe, jane.doe@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.3", text: "Please state how many databases you have in each environment (Production, Development, Test, DR).", whyRelevant: "Determines the scope and effort for Oracle database inventory configuration.", exampleResponse: "Production: 25\nDevelopment: 15\nTest/UAT: 10\nDR: 8", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.4", text: "Do you use any standby technologies (e.g. Data Guard) which will restrict the number of databases accessible for inventory due to them being in a standby state?", whyRelevant: "Standby databases may not be directly queryable and require alternative inventory approaches.", exampleResponse: "Yes, we use Active Data Guard for 8 databases. The standby databases are read-only.", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.5", text: "Oracle Database connections are typically established using port 1521. Please state any other ports used by your Oracle Databases.", whyRelevant: "Non-standard ports need to be configured in the connector and may require firewall rule changes.", exampleResponse: "Most use 1521. Financial databases use port 1525.", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.6", text: "Are there any data security or access control restrictions that may restrict the ability for Certero to perform an inventory on your Oracle databases?", whyRelevant: "Security restrictions may require special arrangements or approvals before connector deployment.", exampleResponse: "PCI-compliant databases require change approval and whitelisted source IPs", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.7", text: "Where are your Oracle databases located? Please include any Oracle Cloud or 3rd party cloud.", whyRelevant: "Cloud-hosted databases may have different connectivity requirements and licensing models.", exampleResponse: "On-premise datacentres in London and New York. 5 databases in Oracle Cloud Infrastructure (OCI).", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.8", text: "What operating system environments do you use to host your Oracle Databases?", whyRelevant: "The OS platform affects Oracle licensing rules (e.g. processor core factors) and inventory methods.", exampleResponse: "Linux (RHEL 8 and Oracle Linux 7), Solaris 11, Windows Server 2019", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.9", text: "Do you use Oracle Enterprise Manager (OEM)? If so, please provide the FQDN of each OEM instance.", whyRelevant: "OEM can provide additional discovery and inventory data as a supplementary data source.", exampleResponse: "Yes, oem01.anyco.local (OEM 13.5)", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.10", text: "Are any of your Oracle databases managed by 3rd party organisations? If so, how many and by whom?", whyRelevant: "Third-party managed databases may require coordination with the provider for access and data collection.", exampleResponse: "Yes, 10 databases managed by Accenture under our outsourcing agreement", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.11", text: "Do you have any in-house Oracle-supplied hardware running Oracle Database (e.g. Oracle Private Cloud Appliance, Exadata)?", whyRelevant: "Oracle hardware has specific licensing rules (e.g. Exadata is hard-partitioned) that affect compliance calculations.", exampleResponse: "Yes, 1 Exadata X8M quarter rack in production", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.12", text: "Please provide the following details of two sample Oracle Databases:\n- Computer FQDN\n- IP address\n- Database Instance Name\n- Database Name\n- TNS Service Name\n- Port\n- Database Description", whyRelevant: "Sample database details are used for initial connectivity testing before rolling out to all databases.", exampleResponse: "FQDN: oradb01.anyco.local\nIP: 10.1.2.3\nInstance: ORCL1\nDB Name: FINPROD\nTNS Service: FINPROD.anyco.local\nPort: 1521\nDescription: Finance Production Database", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.13", text: "If you use Oracle Pluggable Databases (Multi-Tenant Architecture), please provide details for one Container Database (CDB) and one Pluggable Database (PDB).", whyRelevant: "Multi-tenant architecture requires specific connector configuration and has licensing implications.", exampleResponse: "CDB: CDBPROD on oradb02.anyco.local (port 1521)\nPDB: HRPDB1 within CDBPROD", scope: "both", isNew: true, inputType: "textarea", techGroup: "oradb" },
        { ref: "2.19.14", text: "Please state the different Oracle Middleware solutions you have and how many of each.", whyRelevant: "Determines the scope of Oracle Middleware licensing compliance analysis.", exampleResponse: "WebLogic Server: 8 instances\nOracle SOA Suite: 3 instances\nOracle Forms & Reports: 2 instances", scope: "both", isNew: true, inputType: "textarea", techGroup: "oramw" },
        { ref: "2.19.15", text: "Please provide a technical contact for each of your Oracle Middleware solutions.", whyRelevant: "Technical contacts are needed for configuring middleware inventory collection.", exampleResponse: "WebLogic: Alex Turner, alex.turner@anyco.com\nSOA Suite: Maria Garcia, maria.garcia@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "oramw" },
        { ref: "2.19.16", text: "What operating system environments do you use to host your Oracle Middleware solutions?", whyRelevant: "OS platform affects middleware licensing calculations and inventory methods.", exampleResponse: "Linux (RHEL 8) for WebLogic and SOA Suite. Windows Server 2019 for Forms & Reports.", scope: "both", isNew: true, inputType: "textarea", techGroup: "oramw" },
        { ref: "2.19.17", text: "Are any of your Oracle Middleware solutions managed by 3rd party organisations?", whyRelevant: "Third-party managed middleware may require coordination for access and inventory.", exampleResponse: "No, all managed in-house", scope: "both", isNew: true, inputType: "textarea", techGroup: "oramw" },
        { ref: "2.19.18", text: "Do you have any in-house Oracle-supplied hardware running Oracle Middleware?", whyRelevant: "Oracle hardware has specific licensing rules that affect middleware compliance calculations.", exampleResponse: "No", scope: "both", isNew: true, inputType: "textarea", techGroup: "oramw" },
        { ref: "2.19.19", text: "Where are your Oracle Middleware solutions located? Please include any Oracle Cloud or 3rd party cloud.", whyRelevant: "Cloud-hosted middleware may have different connectivity and licensing considerations.", exampleResponse: "All on-premise in London and New York datacentres", scope: "both", isNew: true, inputType: "textarea", techGroup: "oramw" },
        { ref: "2.19.20", text: "Please provide details of each E-Business Suite environment:\n- FQDN of the host(s)\n- Type (Production, Development, Test, or DR)", whyRelevant: "EBS environment details are needed to configure the EBS connector for user and licence data extraction.", exampleResponse: "Production: ebs-prod.anyco.local\nDevelopment: ebs-dev.anyco.local\nDR: ebs-dr.anyco.local", scope: "both", isNew: true, inputType: "textarea", techGroup: "oraebs" },
        { ref: "2.19.21", text: "Please provide the technical contact(s) for your Oracle E-Business Suite environments.", whyRelevant: "Technical contacts are needed for EBS connector configuration and access provisioning.", exampleResponse: "Chris Evans, EBS Admin, chris.evans@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "oraebs" },
        { ref: "2.19.22", text: "Are any of your EBS environments managed by 3rd party organisations?", whyRelevant: "Third-party managed EBS may require coordination for access and data collection.", exampleResponse: "Yes, production EBS is managed by TCS", scope: "both", isNew: true, inputType: "textarea", techGroup: "oraebs" },
        { ref: "2.19.23", text: "Please provide details of a sample Oracle E-Business Suite system for connectivity testing.", whyRelevant: "A sample system is used to validate EBS connector configuration before rolling out to all environments.", exampleResponse: "Dev environment: ebs-dev.anyco.local\nDB: EBSDEV on oradb03.anyco.local:1521\nApps tier: ebsapp-dev.anyco.local", scope: "both", isNew: true, inputType: "textarea", techGroup: "oraebs" }
      ]
    },

    {
      id: "2.20", title: "Certero for SaaS", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Certero for SaaS (C4SaaS) module in scope",
      hasTechSelector: true,
      techOptions: [
        { key: "m365", label: "Microsoft 365" },
        { key: "salesforce", label: "Salesforce" },
        { key: "google", label: "Google Workspace" },
        { key: "adobe", label: "Adobe Creative Cloud" },
        { key: "okta", label: "Okta" },
        { key: "zoom", label: "Zoom" },
        { key: "slack", label: "Slack" },
        { key: "box", label: "Box" },
        { key: "dropbox", label: "Dropbox" },
        { key: "tableau", label: "Tableau" },
        { key: "wrike", label: "Wrike" }
      ],
      questions: [
        { ref: "2.20.1", text: "Please provide a technical contact that is an Azure AD / Entra ID Global Administrator.", whyRelevant: "A Global Admin (or Global Reader) is needed to grant the required API permissions for the Microsoft 365 connector.", exampleResponse: "Emma White, Azure AD Admin, emma.white@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "m365" },
        { ref: "2.20.2", text: "Do you have a single or multiple Microsoft 365 tenants?", whyRelevant: "Each tenant requires a separate connector configuration.", exampleResponse: "2 tenants: anyco.onmicrosoft.com and anyco-legacy.onmicrosoft.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "m365" },
        { ref: "2.20.3", text: "Please list each M365 tenant name and confirm whether Application or Delegated permissions will be used.", whyRelevant: "Application permissions (recommended) don't require a signed-in user; Delegated permissions require admin consent.", exampleResponse: "anyco.onmicrosoft.com — Application permissions\nanyco-legacy.onmicrosoft.com — Application permissions", scope: "both", isNew: true, inputType: "textarea", techGroup: "m365" },
        { ref: "2.20.4", text: "Confirm direct internet access via HTTPS 443 to: graph.microsoft.com, login.microsoftonline.com, and related Microsoft endpoints.", whyRelevant: "The M365 connector must reach Microsoft Graph API endpoints to collect user, licence, and usage data.", exampleResponse: "Yes, outbound HTTPS to these endpoints is permitted through our proxy", scope: "both", isNew: true, inputType: "textarea", techGroup: "m365" },
        { ref: "2.20.5", text: "Please provide an administrative contact for your Salesforce account(s).", whyRelevant: "A Salesforce administrator is needed to create the Connected App and grant API access for the connector.", exampleResponse: "Rachel Green, Salesforce Admin, rachel.green@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "salesforce" },
        { ref: "2.20.6", text: "Please list each Salesforce account name and URL.", whyRelevant: "Each Salesforce org requires a separate connector configuration.", exampleResponse: "Production: https://anyco.my.salesforce.com\nSandbox: https://anyco--uat.sandbox.my.salesforce.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "salesforce" },
        { ref: "2.20.7", text: "Please provide an administrative contact for your Google Workspace account.", whyRelevant: "A Google Workspace Super Admin is needed to set up domain-wide delegation for the connector.", exampleResponse: "Kevin Lee, Google Admin, kevin.lee@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "google" },
        { ref: "2.20.8", text: "Please list your Google Workspace account names (primary domains).", whyRelevant: "Each Google Workspace domain requires connector configuration.", exampleResponse: "anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "google" },
        { ref: "2.20.9", text: "Please provide an administrative contact for your Adobe Creative Cloud account.", whyRelevant: "An Adobe Admin Console administrator is needed to create API credentials for the connector.", exampleResponse: "Amy Taylor, Adobe Admin, amy.taylor@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "adobe" },
        { ref: "2.20.10", text: "Please list your Adobe Creative Cloud account names and Organization IDs.", whyRelevant: "Each Adobe organisation requires a separate connector configuration.", exampleResponse: "AnyCompany Inc — Org ID: 12345ABC@AdobeOrg", scope: "both", isNew: true, inputType: "textarea", techGroup: "adobe" },
        { ref: "2.20.11", text: "Please provide an administrative contact for your Okta account(s).", whyRelevant: "An Okta administrator is needed to create an API token for the connector.", exampleResponse: "James Martin, Okta Admin, james.martin@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "okta" },
        { ref: "2.20.12", text: "Please list your Okta account names and URLs.", whyRelevant: "Each Okta org requires a separate connector configuration.", exampleResponse: "anyco.okta.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "okta" },
        { ref: "2.20.13", text: "Please provide a technical contact for your Zoom account.", whyRelevant: "A Zoom admin is needed to create a Server-to-Server OAuth app for the connector.", exampleResponse: "Paul Harris, Zoom Admin, paul.harris@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "zoom" },
        { ref: "2.20.14", text: "Please list your Zoom account names.", whyRelevant: "Each Zoom account requires a separate connector configuration.", exampleResponse: "AnyCompany Zoom (Enterprise)", scope: "both", isNew: true, inputType: "textarea", techGroup: "zoom" },
        { ref: "2.20.15", text: "Please provide the primary owner/admin contact for your Slack workspace(s).", whyRelevant: "A Slack workspace owner or admin is needed to install the connector app.", exampleResponse: "Natasha Clark, Slack Admin, natasha.clark@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "slack" },
        { ref: "2.20.16", text: "Please list your Slack workspace names.", whyRelevant: "Each Slack workspace requires a separate connector configuration.", exampleResponse: "AnyCompany (Enterprise Grid)", scope: "both", isNew: true, inputType: "textarea", techGroup: "slack" },
        { ref: "2.20.17", text: "Please provide an administrative contact for your Box account.", whyRelevant: "A Box admin or co-admin is needed to create a custom app for the connector.", exampleResponse: "Laura Adams, Box Admin, laura.adams@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "box" },
        { ref: "2.20.18", text: "Please list your Box account names.", whyRelevant: "Each Box enterprise account requires connector configuration.", exampleResponse: "AnyCompany Box Enterprise", scope: "both", isNew: true, inputType: "textarea", techGroup: "box" },
        { ref: "2.20.19", text: "Please provide an administrative contact for your Dropbox for Business account.", whyRelevant: "A Dropbox Business admin is needed to create a Dropbox app for the connector.", exampleResponse: "Ryan Hall, Dropbox Admin, ryan.hall@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "dropbox" },
        { ref: "2.20.20", text: "Please list your Dropbox for Business account names.", whyRelevant: "Each Dropbox Business account requires connector configuration.", exampleResponse: "AnyCompany Dropbox Business", scope: "both", isNew: true, inputType: "textarea", techGroup: "dropbox" },
        { ref: "2.20.21", text: "Please provide an administrative contact for your Tableau Online account.", whyRelevant: "A Tableau Site Admin is needed to create API credentials for the connector.", exampleResponse: "Mark Robinson, Tableau Admin, mark.robinson@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "tableau" },
        { ref: "2.20.22", text: "Please list your Tableau Online sites and home page URLs.", whyRelevant: "Each Tableau site requires connector configuration.", exampleResponse: "AnyCompany — https://prod-uk-a.online.tableau.com/#/site/anyco", scope: "both", isNew: true, inputType: "textarea", techGroup: "tableau" },
        { ref: "2.20.23", text: "Please provide a technical contact for your Wrike account(s)/workspace(s).", whyRelevant: "A Wrike admin is needed to create an API app for the connector.", exampleResponse: "Diana Ross, Wrike Admin, diana.ross@anyco.com", scope: "both", isNew: true, inputType: "textarea", techGroup: "wrike" },
        { ref: "2.20.24", text: "Please list your Wrike account names.", whyRelevant: "Each Wrike account requires connector configuration.", exampleResponse: "AnyCompany Wrike Enterprise", scope: "both", isNew: true, inputType: "textarea", techGroup: "wrike" }
      ]
    },

    {
      id: "2.21", title: "Certero for SAP", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Certero for SAP (C4SAP) module in scope",
      questions: [
        { ref: "2.21.1", text: "What is the approximate number of SAP Named Users?", whyRelevant: "Determines the scale of SAP licence compliance analysis and potential optimisation opportunities.", exampleResponse: "3,500 named users", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.21.2", text: "How many SAP systems (ABAP only) do you have?\nPlease split by Production and Development.", whyRelevant: "The SAP connector connects to ABAP systems only (not Java-only). Production and Development systems are in scope (not pre-production/UAT).", exampleResponse: "Production: 4 systems (ECC, BW, SRM, GRC)\nDevelopment: 4 systems", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.21.3", text: "Please list the SAP Named User License Types and the approximate quantity of each licence.\n(e.g. Professional, Limited Professional, Project User, Logistics User, Worker User, etc.)", whyRelevant: "Understanding your licence entitlement structure is essential for configuring accurate compliance analysis.", exampleResponse: "Professional: 500\nLimited Professional: 1,200\nProject User: 300\nLogistics User: 800\nWorker User: 700", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.21.4", text: "Please provide a technical contact that understands the SAP Server landscape.", whyRelevant: "Required for configuring SAP RFC connections and validating system landscape data.", exampleResponse: "Hans Mueller, SAP Basis Lead, hans.mueller@anyco.com", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.21.5", text: "Please provide a technical contact for SAP Role and User Administration.", whyRelevant: "Required for configuring the RFC user account and understanding user management processes.", exampleResponse: "Priya Sharma, SAP Security, priya.sharma@anyco.com", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.21.6", text: "The solution can automatically consolidate users from multiple SAP Systems based on SAP User ID. Do you have common User IDs for Named Users across different SAP Systems?", whyRelevant: "Common User IDs enable automatic cross-system user consolidation for accurate licence compliance.", exampleResponse: "Yes, we use the same User ID (based on employee number) across all SAP systems", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.21.7", text: "The solution can automatically consolidate users from multiple SAP Systems based on Email Address. Does each Named User have a unique email address and is it recorded in SAP?", whyRelevant: "Email-based consolidation is an alternative to User ID matching when IDs differ across systems.", exampleResponse: "Yes, all users have a unique corporate email recorded in SAP user master", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "2.21.8", text: "What is the process for removing users from the SAP system? Are users Locked and End Dated, or Deleted when they leave the business?", whyRelevant: "Understanding the user removal process affects how the solution identifies inactive users and calculates licence consumption.", exampleResponse: "Users are locked and end-dated immediately, then deleted after 90 days", scope: "both", isNew: true, inputType: "textarea" }
      ]
    }
  ]
};

/* ═══════════════════════════════════════════════
   APPLICATION STATE
   ═══════════════════════════════════════════════ */
/* ── Customer Config (injected by generate-customer.ps1 for customer portals) ── */
const CUSTOMER_CONFIG = {
  customerName: "Company Name",
  userName: "Unassigned",
  templateMode: "onprem",
  jiraTicket: "TMT4-128",
  lockedSections: {
    "1.8": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.10": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.11": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.12": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.13": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.14": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.16": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.18": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.19": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.20": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." },
    "2.21": { locked: true, reason: "Not included in your project scope. Contact your account manager or PMO for details." }
  },
  preSelectedTechs: {

  },
  allowedTechs: {

  }
};

const STORAGE_KEY = 'icq_portal_data';
let gateMode = 'onprem';
let state = {
  templateMode: 'onprem',
  customerName: '',
  userName: '',
  responses: {},
  sectionsInScope: {},
  sectionsCollapsed: {},
  activeTab: 'full',
  sectionAssignees: {},
  selectedTechs: {},
  auditLog: []
};
let saveTimeout = null;

/* ═══════════════════════════════════════════════
   INIT
   ═══════════════════════════════════════════════ */
document.addEventListener('DOMContentLoaded', () => {
  loadState();
  // Auto-bypass gate for customer portals or if saved state exists
  if (typeof CUSTOMER_CONFIG !== 'undefined' && CUSTOMER_CONFIG) {
    // Customer portal: always bypass gate
    passGate();
  } else if (state.userName && state.userName.trim() && state.customerName && state.customerName.trim()) {
    passGate();
  }
  // Enter key on gate inputs triggers start
  document.getElementById('gateUserName').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') startICQ();
  });
  document.getElementById('gateCustomerName').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') startICQ();
  });
});

/* ═══════════════════════════════════════════════
   GATE LOGIC
   ═══════════════════════════════════════════════ */
function setGateMode(mode) {
  gateMode = mode;
  document.querySelectorAll('.gate-toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.gmode === mode);
  });
}

function startICQ() {
  const userInput = document.getElementById('gateUserName');
  const custInput = document.getElementById('gateCustomerName');
  const user = userInput.value.trim();
  const cust = custInput.value.trim();
  if (!user) {
    document.getElementById('gateError').textContent = 'Please enter your name to continue.';
    userInput.focus();
    return;
  }
  if (!cust) {
    document.getElementById('gateError').textContent = 'Please enter a customer name to continue.';
    custInput.focus();
    return;
  }
  document.getElementById('gateError').textContent = '';
  state.userName = user;
  state.customerName = cust;
  state.templateMode = gateMode;
  addAudit('login', 'Logged in (' + gateMode + ') for customer "' + cust + '"');
  saveNow();
  passGate();
}

function passGate() {
  document.getElementById('gateOverlay').classList.add('hidden');
  document.getElementById('appWrapper').classList.add('visible');
  document.getElementById('customerDisplay').textContent = state.customerName + ' | ' + state.userName;
  // Sync header toggle with state
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.mode === state.templateMode);
  });
  // Grey out the non-relevant mode toggle on customer portals
  if (typeof CUSTOMER_CONFIG !== 'undefined' && CUSTOMER_CONFIG) {
    document.querySelectorAll('.toggle-btn').forEach(btn => {
      if (btn.dataset.mode !== state.templateMode) {
        btn.style.opacity = '0.3';
        btn.style.pointerEvents = 'none';
        btn.style.cursor = 'default';
      }
    });
  }
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tab === state.activeTab);
  });
  renderICQ();
  updateStats();
  updateStickyOffsets();
}

function updateStickyOffsets() {
  const header = document.querySelector('.header');
  const stats = document.getElementById('stickyStats');
  if (!header || !stats) return;
  const headerH = header.offsetHeight;
  stats.style.top = headerH + 'px';
  const stickyBottom = headerH + stats.offsetHeight;
  document.querySelectorAll('.section-header').forEach(sh => {
    sh.style.top = stickyBottom + 'px';
  });
}

window.addEventListener('resize', updateStickyOffsets);

/* ═══════════════════════════════════════════════
   STATE MANAGEMENT
   ═══════════════════════════════════════════════ */
function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const parsed = JSON.parse(saved);
      state = { ...state, ...parsed };
    }
  } catch (e) {
    console.warn('Failed to load saved state:', e);
  }
  // Initialize defaults
  ICQ_DATA.sections.forEach(s => {
    if (s.conditional && state.sectionsInScope[s.id] === undefined) {
      state.sectionsInScope[s.id] = true;
    }
    if (state.sectionsCollapsed[s.id] === undefined) {
      state.sectionsCollapsed[s.id] = true;
    }
  });
  // Apply CUSTOMER_CONFIG — always enforce identity, mode, and locked sections
  if (typeof CUSTOMER_CONFIG !== 'undefined' && CUSTOMER_CONFIG) {
    state.customerName = CUSTOMER_CONFIG.customerName || state.customerName;
    state.userName = CUSTOMER_CONFIG.userName || state.userName;
    state.templateMode = CUSTOMER_CONFIG.templateMode || state.templateMode;
    // Always enforce locked sections as out-of-scope
    if (CUSTOMER_CONFIG.lockedSections) {
      Object.keys(CUSTOMER_CONFIG.lockedSections).forEach(id => {
        if (CUSTOMER_CONFIG.lockedSections[id].locked) {
          state.sectionsInScope[id] = false;
        }
      });
    }
    // Pre-select tech options on first load only
    if (!localStorage.getItem(STORAGE_KEY) && CUSTOMER_CONFIG.preSelectedTechs) {
      Object.keys(CUSTOMER_CONFIG.preSelectedTechs).forEach(id => {
        state.selectedTechs[id] = CUSTOMER_CONFIG.preSelectedTechs[id];
      });
    }
    // Ensure all sections start collapsed in customer portals
    ICQ_DATA.sections.forEach(s => {
      state.sectionsCollapsed[s.id] = true;
    });
    saveNow();
  }
}

function saveState() {
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(() => {
    saveNow();
  }, 300);
}

function saveNow() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    showSaveIndicator();
  } catch (e) {
    console.warn('Failed to save state:', e);
  }
}

function showSaveIndicator() {
  const el = document.getElementById('saveIndicator');
  if (el) {
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 1500);
  }
}

/* ═══════════════════════════════════════════════
   SAVE / LOAD PROGRESS FILES
   ═══════════════════════════════════════════════ */
function saveProgress() {
  const data = {
    _type: 'icq-progress',
    _version: '2.0',
    savedAt: new Date().toISOString(),
    userName: state.userName,
    customerName: state.customerName,
    templateMode: state.templateMode,
    responses: state.responses,
    sectionsInScope: state.sectionsInScope,
    sectionsCollapsed: state.sectionsCollapsed,
    sectionAssignees: state.sectionAssignees,
    selectedTechs: state.selectedTechs,
    activeTab: state.activeTab,
    auditLog: state.auditLog
  };
  addAudit('export', 'Saved progress file');
  saveNow();
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const customerSlug = (state.customerName || 'unnamed').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
  a.href = url;
  a.download = `ICQ-Progress-${customerSlug}-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function loadProgressFile(input, fromGate) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      if (data._type !== 'icq-progress') {
        alert('Invalid file. Please select an ICQ progress file.');
        return;
      }
      // Restore state
      state.userName = data.userName || '';
      state.customerName = data.customerName || '';
      state.templateMode = data.templateMode || 'onprem';
      state.responses = data.responses || {};
      state.sectionsInScope = data.sectionsInScope || {};
      state.sectionsCollapsed = data.sectionsCollapsed || {};
      state.sectionAssignees = data.sectionAssignees || {};
      state.selectedTechs = data.selectedTechs || {};
      state.activeTab = data.activeTab || 'full';
      state.auditLog = data.auditLog || [];
      // Re-initialize any missing scope defaults
      ICQ_DATA.sections.forEach(s => {
        if (s.conditional && state.sectionsInScope[s.id] === undefined) {
          state.sectionsInScope[s.id] = true;
        }
      });
      addAudit('load', 'Loaded progress file: ' + file.name);
      saveNow();
      if (!state.customerName.trim()) {
        alert('Progress file has no customer name. Please enter a customer name.');
        return;
      }
      passGate();
    } catch (err) {
      alert('Failed to read progress file: ' + err.message);
    }
  };
  reader.readAsText(file);
  // Reset file input so same file can be re-selected
  input.value = '';
}

/* ═══════════════════════════════════════════════
   RENDER
   ═══════════════════════════════════════════════ */
function renderICQ() {
  const container = document.getElementById('mainContent');
  container.innerHTML = '';

  const mode = state.templateMode;
  const isNewTab = state.activeTab === 'new';
  const isOosTab = state.activeTab === 'oos';

  // Group by category
  const aboutYou = ICQ_DATA.sections.filter(s => s.category === 'about-you');
  const aboutSolution = ICQ_DATA.sections.filter(s => s.category === 'about-solution');

  function renderGroup(title, sections) {
    // Filter sections that have visible questions
    const visibleSections = sections.filter(s => {
      if (s.scope !== 'both' && s.scope !== mode) return false;
      const isInScope = state.sectionsInScope[s.id] !== false;
      if (isOosTab) return !isInScope;
      if (!isOosTab && !isInScope) return false;
      if (isNewTab) {
        const newQs = s.questions.filter(q =>
          q.isNew && (q.scope === 'both' || q.scope === mode)
        );
        return newQs.length > 0;
      }
      return true;
    });

    if (visibleSections.length === 0) return;

    const header = document.createElement('div');
    header.className = 'category-header';
    header.textContent = title;
    container.appendChild(header);

    visibleSections.forEach(section => {
      container.appendChild(renderSection(section, mode, isNewTab));
    });
  }

  renderGroup('About You', aboutYou);
  renderGroup('About the Solution', aboutSolution);

  // Update sticky offsets for new section headers
  requestAnimationFrame(updateStickyOffsets);
}

function isLockedSection(sectionId) {
  return typeof CUSTOMER_CONFIG !== 'undefined' && CUSTOMER_CONFIG
    && CUSTOMER_CONFIG.lockedSections
    && CUSTOMER_CONFIG.lockedSections[sectionId]
    && CUSTOMER_CONFIG.lockedSections[sectionId].locked;
}

function renderSection(section, mode, isNewTab) {
  const el = document.createElement('div');
  el.className = 'section';
  el.dataset.sectionId = section.id;

  const locked = isLockedSection(section.id);
  const isCollapsed = state.sectionsCollapsed[section.id];
  const isInScope = locked ? false : (state.sectionsInScope[section.id] !== false);

  if (locked) el.classList.add('locked-scope');
  if (isCollapsed) el.classList.add('collapsed');

  // Get selected techs for this section
  const sectionTechs = state.selectedTechs[section.id] || [];

  // Get visible questions
  const visibleQuestions = section.questions.filter(q => {
    if (q.scope !== 'both' && q.scope !== mode) return false;
    if (isNewTab && !q.isNew) return false;
    if (q.techGroup && !sectionTechs.includes(q.techGroup)) return false;
    return true;
  });

  const answeredCount = visibleQuestions.filter(q => (state.responses[q.ref] || '').trim()).length;
  const totalCount = visibleQuestions.length;
  const newCount = visibleQuestions.filter(q => q.isNew).length;

  // Header
  const assignee = state.sectionAssignees[section.id] || {};
  const header = document.createElement('div');
  header.className = 'section-header';
  header.innerHTML = `
    <div class="section-header-left">
      <span class="section-chevron">&#9660;</span>
      <span class="section-title"><span class="section-ref">${section.id}</span>${section.title}</span>
      <span class="section-progress">${answeredCount}/${totalCount}</span>
    </div>
    <div class="section-header-right">
      <div class="section-header-assignee" onclick="event.stopPropagation()">
        <input type="text" placeholder="Name..." value="${escapeAttr(assignee.name || '')}" data-section="${section.id}" data-field="name" oninput="handleAssignee(this)" />
        <input type="email" placeholder="Email..." value="${escapeAttr(assignee.email || '')}" data-section="${section.id}" data-field="email" oninput="handleAssignee(this)" />
      </div>
      ${newCount > 0 && !isNewTab ? `<span class="new-count-badge">${newCount} NEW</span>` : ''}
      ${(!locked && section.conditional) ? `
        <label class="scope-toggle" onclick="event.stopPropagation()">
          <input type="checkbox" ${isInScope ? 'checked' : ''} onchange="toggleScope('${section.id}', this.checked)" />
          <span>${section.conditionalLabel || 'In Scope'}</span>
        </label>
      ` : ''}
    </div>
  `;

  header.addEventListener('click', (e) => {
    if (e.target.closest('.scope-toggle') || e.target.closest('.section-header-assignee')) return;
    toggleCollapse(section.id);
  });

  el.appendChild(header);

  // Locked section notice banner
  if (locked) {
    const lockReason = CUSTOMER_CONFIG.lockedSections[section.id].reason || 'This module is not included in your project scope. Contact your account manager or PMO for further details.';
    const notice = document.createElement('div');
    notice.className = 'locked-notice';
    notice.textContent = lockReason;
    el.appendChild(notice);
  }

  // Section progress bar
  const pct = totalCount > 0 ? Math.round((answeredCount / totalCount) * 100) : 0;
  const progressBar = document.createElement('div');
  progressBar.className = 'section-progress-bar';
  progressBar.innerHTML = `<div class="section-progress-fill" style="width:${pct}%"></div>`;
  el.appendChild(progressBar);

  // Body
  const body = document.createElement('div');
  body.className = 'section-body';

  // Tech selector (if section has technology options)
  if (section.hasTechSelector && section.techOptions) {
    // Filter tech options to only allowed ones when CUSTOMER_CONFIG.allowedTechs is set
    let visibleTechOptions = section.techOptions;
    if (typeof CUSTOMER_CONFIG !== 'undefined' && CUSTOMER_CONFIG && CUSTOMER_CONFIG.allowedTechs && CUSTOMER_CONFIG.allowedTechs[section.id]) {
      const allowed = CUSTOMER_CONFIG.allowedTechs[section.id];
      visibleTechOptions = section.techOptions.filter(t => allowed.includes(t.key));
    }
    const techPanel = document.createElement('div');
    techPanel.className = 'tech-selector';
    techPanel.innerHTML = `
      <div class="tech-selector-label">Select technologies in use:</div>
      <div class="tech-selector-options">
        ${visibleTechOptions.map(t => `
          <label class="tech-option ${sectionTechs.includes(t.key) ? 'selected' : ''}" onclick="event.stopPropagation()">
            <input type="checkbox" ${sectionTechs.includes(t.key) ? 'checked' : ''} onchange="toggleTech('${section.id}', '${t.key}', this.checked)" />
            <span>${t.label}</span>
          </label>
        `).join('')}
      </div>
    `;
    body.appendChild(techPanel);
  }

  visibleQuestions.forEach(q => {
    body.appendChild(renderQuestion(q));
  });

  el.appendChild(body);
  return el;
}

function renderQuestion(q) {
  const el = document.createElement('div');
  el.className = 'question-card';
  el.dataset.ref = q.ref;

  const answer = state.responses[q.ref] || '';
  if (answer.trim()) el.classList.add('answered');

  const whyId = 'why-' + q.ref.replace(/\./g, '-');
  const exId = 'ex-' + q.ref.replace(/\./g, '-');

  let inputHTML = '';
  if (q.inputType === 'select' && q.options) {
    const optionsHTML = q.options.map(o =>
      `<option value="${o}" ${answer === o ? 'selected' : ''}>${o}</option>`
    ).join('');
    inputHTML = `<select class="question-input" data-ref="${q.ref}" onchange="handleInput(this)">\n<option value="">-- Select --</option>\n${optionsHTML}\n</select>`;
  } else if (q.inputType === 'text') {
    inputHTML = `<input type="text" class="question-input" data-ref="${q.ref}" value="${escapeAttr(answer)}" placeholder="Enter your response..." oninput="handleInput(this)" />`;
  } else {
    inputHTML = `<textarea class="question-input" data-ref="${q.ref}" placeholder="Enter your response..." oninput="handleInput(this)">${escapeHTML(answer)}</textarea>`;
  }

  el.innerHTML = `
    <div class="question-header">
      <span class="question-ref">${q.ref}</span>
      <span class="question-text">${escapeHTML(q.text).replace(/\n/g, '<br>')}</span>
      ${q.isNew ? '<span class="new-badge">NEW</span>' : ''}
    </div>
    <div class="expand-row">
      ${q.whyRelevant ? `<button class="expand-btn" onclick="toggleExpand('${whyId}')">Why relevant?</button>` : ''}
      ${q.exampleResponse ? `<button class="expand-btn" onclick="toggleExpand('${exId}')">Example response</button>` : ''}
    </div>
    ${q.whyRelevant ? `<div class="expand-content" id="${whyId}"><div class="expand-label">Why is this relevant?</div>${escapeHTML(q.whyRelevant)}</div>` : ''}
    ${q.exampleResponse ? `<div class="expand-content" id="${exId}"><div class="expand-label">Example Response</div>${escapeHTML(q.exampleResponse).replace(/\n/g, '<br>')}</div>` : ''}
    ${inputHTML}
  `;

  return el;
}

/* ═══════════════════════════════════════════════
   EVENT HANDLERS
   ═══════════════════════════════════════════════ */
function handleInput(el) {
  const ref = el.dataset.ref;
  const oldVal = state.responses[ref] || '';
  state.responses[ref] = el.value;

  // Audit: log answer changes (debounced via a per-ref timer)
  clearTimeout(el._auditTimer);
  el._auditTimer = setTimeout(() => {
    if (el.value.trim() && el.value !== oldVal) {
      addAudit('answer', ref + ': answered');
      saveNow();
    } else if (!el.value.trim() && oldVal.trim()) {
      addAudit('answer', ref + ': cleared');
      saveNow();
    }
  }, 1000);

  // Update card styling
  const card = el.closest('.question-card');
  if (card) card.classList.toggle('answered', el.value.trim() !== '');

  // Update section progress bar
  const sectionEl = el.closest('.section');
  if (sectionEl) updateSectionProgress(sectionEl);

  saveState();
  updateStats();
}

function updateSectionProgress(sectionEl) {
  const cards = sectionEl.querySelectorAll('.question-card');
  const total = cards.length;
  const answered = Array.from(cards).filter(c => c.classList.contains('answered')).length;
  const pct = total > 0 ? Math.round((answered / total) * 100) : 0;
  const fill = sectionEl.querySelector('.section-progress-fill');
  if (fill) fill.style.width = pct + '%';
  const counter = sectionEl.querySelector('.section-progress');
  if (counter) counter.textContent = answered + '/' + total;
}

function handleAssignee(el) {
  const sectionId = el.dataset.section;
  const field = el.dataset.field;
  if (!state.sectionAssignees[sectionId]) {
    state.sectionAssignees[sectionId] = { name: '', email: '' };
  }
  state.sectionAssignees[sectionId][field] = el.value;
  saveState();
}

function setMode(mode) {
  // Prevent mode switching on customer portals
  if (typeof CUSTOMER_CONFIG !== 'undefined' && CUSTOMER_CONFIG) return;
  state.templateMode = mode;
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.mode === mode);
  });
  saveState();
  renderICQ();
  updateStats();
}

function setTab(tab) {
  state.activeTab = tab;
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tab === tab);
  });
  saveState();
  renderICQ();
  updateStats();
}

function toggleCollapse(sectionId) {
  state.sectionsCollapsed[sectionId] = !state.sectionsCollapsed[sectionId];
  const el = document.querySelector(`.section[data-section-id="${sectionId}"]`);
  if (el) el.classList.toggle('collapsed');
  saveState();
}

function toggleScope(sectionId, checked) {
  // Prevent toggling locked sections back to in-scope
  if (isLockedSection(sectionId)) return;
  state.sectionsInScope[sectionId] = checked;
  addAudit('scope', sectionId + ': ' + (checked ? 'in scope' : 'out of scope'));
  saveState();
  renderICQ();
  updateStats();
}

function toggleTech(sectionId, techKey, checked) {
  if (!state.selectedTechs[sectionId]) state.selectedTechs[sectionId] = [];
  const techs = state.selectedTechs[sectionId];
  if (checked && !techs.includes(techKey)) {
    techs.push(techKey);
  } else if (!checked) {
    state.selectedTechs[sectionId] = techs.filter(t => t !== techKey);
  }
  addAudit('tech', sectionId + ': ' + techKey + ' ' + (checked ? 'enabled' : 'disabled'));
  saveState();
  renderICQ();
  updateStats();
}

function toggleExpand(id) {
  const el = document.getElementById(id);
  if (el) el.classList.toggle('show');
}

/* ═══════════════════════════════════════════════
   STATISTICS
   ═══════════════════════════════════════════════ */
function updateStats() {
  const mode = state.templateMode;
  let totalQ = 0, answered = 0, totalNew = 0, sectionsInScope = 0, sectionsOos = 0;

  ICQ_DATA.sections.forEach(section => {
    if (section.scope !== 'both' && section.scope !== mode) return;
    if (state.sectionsInScope[section.id] === false) {
      sectionsOos++;
      return;
    }

    sectionsInScope++;
    const sectionTechs = state.selectedTechs[section.id] || [];
    section.questions.forEach(q => {
      if (q.scope !== 'both' && q.scope !== mode) return;
      if (q.techGroup && !sectionTechs.includes(q.techGroup)) return;
      totalQ++;
      if (q.isNew) totalNew++;
      if ((state.responses[q.ref] || '').trim()) answered++;
    });
  });

  const remaining = totalQ - answered;
  const pct = totalQ > 0 ? Math.round((answered / totalQ) * 100) : 0;

  document.getElementById('statTotal').textContent = sectionsInScope;
  document.getElementById('statAnswered').textContent = answered;
  document.getElementById('statRemaining').textContent = remaining;
  document.getElementById('statProgress').textContent = pct + '%';
  document.getElementById('progressBarFill').style.width = pct + '%';
  document.getElementById('progressBarPercent').textContent = pct + '%';
  document.getElementById('tabFullCount').textContent = sectionsInScope;
  document.getElementById('tabOosCount').textContent = sectionsOos;
  document.getElementById('tabNewCount').textContent = totalNew;
}

/* ═══════════════════════════════════════════════
   EXPORT
   ═══════════════════════════════════════════════ */
function exportJSON() {
  addAudit('export', 'Exported JSON (' + state.templateMode + ')');
  saveNow();
  const mode = state.templateMode;
  const exportData = {
    meta: {
      ...ICQ_DATA.meta,
      exportedAt: new Date().toISOString(),
      templateMode: mode,
      customerName: state.customerName,
      ...(typeof CUSTOMER_CONFIG !== 'undefined' && CUSTOMER_CONFIG && CUSTOMER_CONFIG.jiraTicket ? { jiraTicket: CUSTOMER_CONFIG.jiraTicket } : {})
    },
    sections: []
  };

  ICQ_DATA.sections.forEach(section => {
    if (section.scope !== 'both' && section.scope !== mode) return;

    const inScope = state.sectionsInScope[section.id] !== false;
    const sectionExport = {
      id: section.id,
      title: section.title,
      inScope: inScope,
      assignedTo: state.sectionAssignees[section.id] || null,
      questions: []
    };

    section.questions.forEach(q => {
      if (q.scope !== 'both' && q.scope !== mode) return;
      sectionExport.questions.push({
        ref: q.ref,
        text: q.text,
        response: state.responses[q.ref] || '',
        isNew: q.isNew
      });
    });

    exportData.sections.push(sectionExport);
  });

  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const customerSlug = (state.customerName || 'unnamed').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
  a.href = url;
  a.download = `ICQ-${customerSlug}-${mode}-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

/* ═══════════════════════════════════════════════
   RESET
   ═══════════════════════════════════════════════ */
function showResetModal() {
  document.getElementById('resetModal').classList.add('show');
}
function hideResetModal() {
  document.getElementById('resetModal').classList.remove('show');
}
function doReset() {
  addAudit('reset', 'Reset all responses');
  // Preserve audit log across reset
  const preservedLog = [...state.auditLog];
  localStorage.removeItem(STORAGE_KEY);
  state = {
    templateMode: 'onprem',
    customerName: '',
    userName: '',
    responses: {},
    sectionsInScope: {},
    sectionsCollapsed: {},
    sectionAssignees: {},
    selectedTechs: {},
    activeTab: 'full',
    auditLog: preservedLog
  };
  // Re-initialize scope and collapse defaults
  ICQ_DATA.sections.forEach(s => {
    if (s.conditional) state.sectionsInScope[s.id] = true;
    state.sectionsCollapsed[s.id] = true;
  });
  hideResetModal();
  // Return to gate
  document.getElementById('appWrapper').classList.remove('visible');
  document.getElementById('gateOverlay').classList.remove('hidden');
  document.getElementById('gateUserName').value = '';
  document.getElementById('gateCustomerName').value = '';
  document.getElementById('gateError').textContent = '';
  gateMode = 'onprem';
  document.querySelectorAll('.gate-toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.gmode === 'onprem');
  });
}

/* ═══════════════════════════════════════════════
   AUDIT LOG
   ═══════════════════════════════════════════════ */
function addAudit(type, detail) {
  state.auditLog.push({
    ts: new Date().toISOString(),
    user: state.userName || '(unknown)',
    type: type,
    detail: detail
  });
}

function showAuditModal() {
  const wrap = document.getElementById('auditTableWrap');
  const log = state.auditLog;
  if (!log.length) {
    wrap.innerHTML = '<div class="audit-empty">No audit entries yet.</div>';
  } else {
    let html = '<table class="audit-table"><thead><tr><th>Timestamp</th><th>User</th><th>Action</th><th>Detail</th></tr></thead><tbody>';
    // Show newest first
    for (let i = log.length - 1; i >= 0; i--) {
      const e = log[i];
      const time = new Date(e.ts).toLocaleString();
      html += `<tr><td>${escapeHTML(time)}</td><td>${escapeHTML(e.user)}</td><td><span class="audit-type ${e.type}">${e.type}</span></td><td>${escapeHTML(e.detail)}</td></tr>`;
    }
    html += '</tbody></table>';
    wrap.innerHTML = html;
  }
  document.getElementById('auditModal').classList.add('show');
}

function hideAuditModal() {
  document.getElementById('auditModal').classList.remove('show');
}

function exportAuditLog() {
  const log = state.auditLog;
  if (!log.length) { alert('No audit entries to export.'); return; }
  const rows = [['Timestamp', 'User', 'Action', 'Detail']];
  log.forEach(e => {
    rows.push([e.ts, e.user, e.type, '"' + (e.detail || '').replace(/"/g, '""') + '"']);
  });
  const csv = rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const customerSlug = (state.customerName || 'unnamed').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
  a.href = url;
  a.download = `ICQ-Audit-${customerSlug}-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

/* ═══════════════════════════════════════════════
   UTILITIES
   ═══════════════════════════════════════════════ */
function escapeHTML(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}
function escapeAttr(str) {
  return str.replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
</script>
</body>
</html>