<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ITAM ICQ</title>
<style>
/* ── CSS Variables & Theme ── */
:root {
  --bg: #0a0e1a;
  --bg-secondary: #111827;
  --bg-card: #151d2e;
  --bg-card-hover: #1a2540;
  --bg-input: #0d1321;
  --border: #1e2d45;
  --border-focus: #7a00df;
  --accent: #7a00df;
  --accent-glow: rgba(122, 0, 223, 0.25);
  --cyan: #34e2e4;
  --cyan-glow: rgba(52, 226, 228, 0.15);
  --green: #10b981;
  --amber: #f59e0b;
  --red: #ef4444;
  --text: #e2e8f0;
  --text-secondary: #94a3b8;
  --text-muted: #64748b;
  --radius: 8px;
  --radius-lg: 12px;
}

* { margin: 0; padding: 0; box-sizing: border-box; }

body {
  font-family: 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  line-height: 1.5;
}

/* ── Scrollbar ── */
::-webkit-scrollbar { width: 8px; }
::-webkit-scrollbar-track { background: var(--bg); }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 4px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-muted); }

/* ── Gate Modal ── */
.gate-overlay {
  position: fixed;
  inset: 0;
  background: var(--bg);
  z-index: 2000;
  display: flex;
  justify-content: center;
  align-items: center;
  transition: opacity 0.3s;
}
.gate-overlay.hidden {
  opacity: 0;
  pointer-events: none;
}
.gate-modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 40px;
  max-width: 460px;
  width: 90%;
  text-align: center;
}
.gate-modal h2 {
  font-size: 1.6rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--cyan), var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  margin-bottom: 4px;
}
.gate-modal .subtitle {
  font-size: 0.85rem;
  color: var(--text-muted);
  margin-bottom: 28px;
}
.gate-modal label {
  display: block;
  text-align: left;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 6px;
}
.gate-input {
  width: 100%;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  padding: 12px 14px;
  font-size: 0.95rem;
  font-family: inherit;
  transition: border-color 0.2s;
  margin-bottom: 6px;
}
.gate-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.gate-input::placeholder { color: var(--text-muted); }
.gate-error {
  font-size: 0.75rem;
  color: var(--red);
  min-height: 20px;
  margin-bottom: 16px;
  text-align: left;
}
.gate-toggle-label {
  display: block;
  text-align: left;
  font-size: 0.8rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 8px;
}
.gate-toggle-container {
  display: flex;
  gap: 0;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 3px;
  margin-bottom: 24px;
}
.gate-toggle-btn {
  flex: 1;
  padding: 8px 16px;
  border: none;
  background: transparent;
  color: var(--text-muted);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 16px;
  transition: all 0.25s;
}
.gate-toggle-btn.active {
  background: var(--accent);
  color: #fff;
  box-shadow: 0 0 12px var(--accent-glow);
}
.gate-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.gate-start-btn {
  width: 100%;
  padding: 12px;
  background: var(--accent);
  border: none;
  border-radius: var(--radius);
  color: #fff;
  font-size: 0.95rem;
  font-weight: 700;
  cursor: pointer;
  transition: background 0.2s;
}
.gate-start-btn:hover { background: #6600bd; }
.gate-load-btn {
  width: 100%;
  padding: 10px;
  background: transparent;
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text-secondary);
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.2s;
}
.gate-load-btn:hover { border-color: var(--accent); color: var(--text); }
.gate-divider {
  font-size: 0.7rem;
  color: var(--text-muted);
  text-transform: uppercase;
  letter-spacing: 1px;
}

/* ── App Wrapper ── */
.app-wrapper {
  display: none;
}
.app-wrapper.visible {
  display: block;
}

/* ── Header ── */
.header {
  background: var(--bg-secondary);
  border-bottom: 1px solid var(--border);
  padding: 16px 24px;
  position: sticky;
  top: 0;
  z-index: 100;
}
.header-top {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 16px;
  flex-wrap: wrap;
}
.header-brand {
  display: flex;
  align-items: center;
  gap: 12px;
}
.header-brand h1 {
  font-size: 1.25rem;
  font-weight: 700;
  background: linear-gradient(135deg, var(--cyan), var(--accent));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}
.header-brand .version {
  font-size: 0.7rem;
  color: var(--text-muted);
  padding: 2px 8px;
  border: 1px solid var(--border);
  border-radius: 10px;
}
.header-controls {
  display: flex;
  align-items: center;
  gap: 12px;
  flex-wrap: wrap;
}
.customer-display {
  font-size: 0.85rem;
  color: var(--cyan);
  font-weight: 600;
  padding: 8px 12px;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  max-width: 220px;
  overflow: hidden;
  text-overflow: ellipsis;
  white-space: nowrap;
}

/* ── Toggle Switch ── */
.toggle-container {
  display: flex;
  align-items: center;
  gap: 0;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: 20px;
  padding: 3px;
}
.toggle-btn {
  padding: 6px 16px;
  border: none;
  background: transparent;
  color: var(--text-muted);
  font-size: 0.8rem;
  font-weight: 600;
  cursor: pointer;
  border-radius: 16px;
  transition: all 0.25s;
}
.toggle-btn.active {
  background: var(--accent);
  color: #fff;
  box-shadow: 0 0 12px var(--accent-glow);
}

/* ── Buttons ── */
.btn {
  padding: 8px 16px;
  border: 1px solid var(--border);
  background: var(--bg-card);
  color: var(--text);
  font-size: 0.8rem;
  font-weight: 600;
  border-radius: var(--radius);
  cursor: pointer;
  transition: all 0.2s;
  display: flex;
  align-items: center;
  gap: 6px;
}
.btn:hover { border-color: var(--accent); background: var(--bg-card-hover); }
.btn-accent { background: var(--accent); border-color: var(--accent); color: #fff; }
.btn-accent:hover { background: #6600bd; }
.btn-green { background: var(--green); border-color: var(--green); color: #fff; }
.btn-green:hover { background: #0d9668; }
.btn-danger { border-color: var(--red); color: var(--red); }
.btn-danger:hover { background: rgba(239, 68, 68, 0.1); }

/* ── Hidden file input ── */
.hidden-input { display: none; }

/* ── Save Indicator ── */
.save-indicator {
  font-size: 0.75rem;
  color: var(--green);
  opacity: 0;
  transition: opacity 0.3s;
}
.save-indicator.show { opacity: 1; }

/* ── Summary Cards ── */
.summary-bar {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
  gap: 12px;
  padding: 16px 24px;
  max-width: 1200px;
  margin: 0 auto;
}
.summary-card {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 16px;
  text-align: center;
}
.summary-card .label {
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-muted);
  margin-bottom: 4px;
}
.summary-card .value {
  font-size: 1.6rem;
  font-weight: 700;
}
.summary-card .value.cyan { color: var(--cyan); }
.summary-card .value.green { color: var(--green); }
.summary-card .value.amber { color: var(--amber); }
.summary-card .value.accent { color: var(--accent); }

/* ── Progress Bar ── */
.progress-bar-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px 12px;
}
.progress-bar-outer {
  height: 6px;
  background: var(--bg-input);
  border-radius: 3px;
  overflow: hidden;
}
.progress-bar-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--cyan));
  border-radius: 3px;
  transition: width 0.4s ease;
}

/* ── Tabs ── */
.tabs-container {
  max-width: 1200px;
  margin: 0 auto;
  padding: 0 24px 16px;
  display: flex;
  gap: 4px;
  border-bottom: 1px solid var(--border);
}
.tab-btn {
  padding: 10px 20px;
  background: transparent;
  border: none;
  color: var(--text-muted);
  font-size: 0.85rem;
  font-weight: 600;
  cursor: pointer;
  border-bottom: 2px solid transparent;
  transition: all 0.2s;
}
.tab-btn:hover { color: var(--text); }
.tab-btn.active {
  color: var(--cyan);
  border-bottom-color: var(--cyan);
}
.tab-btn .badge {
  display: inline-block;
  background: var(--accent);
  color: #fff;
  font-size: 0.65rem;
  padding: 1px 7px;
  border-radius: 10px;
  margin-left: 6px;
  font-weight: 700;
}

/* ── Main Content ── */
.main-content {
  max-width: 1200px;
  margin: 0 auto;
  padding: 16px 24px 48px;
}

/* ── Category Header ── */
.category-header {
  font-size: 1rem;
  font-weight: 700;
  color: var(--cyan);
  text-transform: uppercase;
  letter-spacing: 1.5px;
  margin: 24px 0 12px;
  padding-bottom: 8px;
  border-bottom: 1px solid var(--border);
}

/* ── Section ── */
.section {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  margin-bottom: 12px;
  overflow: hidden;
  transition: opacity 0.3s;
}
.section.out-of-scope {
  opacity: 0.4;
}
.section.hidden { display: none; }
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 14px 18px;
  cursor: pointer;
  user-select: none;
  transition: background 0.2s;
}
.section-header:hover { background: var(--bg-card-hover); }
.section-header-left {
  display: flex;
  align-items: center;
  gap: 10px;
  flex: 1;
}
.section-chevron {
  font-size: 0.7rem;
  color: var(--text-muted);
  transition: transform 0.2s;
  width: 16px;
}
.section.collapsed .section-chevron { transform: rotate(-90deg); }
.section-title {
  font-size: 0.9rem;
  font-weight: 600;
}
.section-title .section-ref {
  color: var(--accent);
  margin-right: 6px;
}
.section-progress {
  font-size: 0.7rem;
  color: var(--text-muted);
  margin-left: 8px;
  white-space: nowrap;
}
.section-header-right {
  display: flex;
  align-items: center;
  gap: 12px;
}
.new-count-badge {
  font-size: 0.6rem;
  font-weight: 700;
  color: var(--amber);
  border: 1px solid var(--amber);
  padding: 1px 7px;
  border-radius: 10px;
  white-space: nowrap;
}

/* ── In Scope Toggle ── */
.scope-toggle {
  display: flex;
  align-items: center;
  gap: 6px;
  font-size: 0.7rem;
  color: var(--text-muted);
  cursor: pointer;
}
.scope-toggle input[type="checkbox"] {
  accent-color: var(--accent);
  width: 14px;
  height: 14px;
}

/* ── Section Progress Bar ── */
.section-progress-bar {
  height: 3px;
  background: var(--bg-input);
  margin: 0 18px;
}
.section-progress-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--accent), var(--cyan));
  border-radius: 2px;
  transition: width 0.4s ease;
}
.section.collapsed .section-progress-bar { display: none; }

/* ── Section Body ── */
.section-body {
  padding: 0 18px 18px;
}
.section.collapsed .section-body { display: none; }

/* ── Question Card ── */
.question-card {
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 14px;
  margin-bottom: 10px;
  background: var(--bg);
  transition: border-color 0.2s;
}
.question-card:hover { border-color: #2a3f65; }
.question-card.answered { border-left: 3px solid var(--green); }
.question-card.hidden { display: none; }

.question-header {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  margin-bottom: 8px;
}
.question-ref {
  font-size: 0.75rem;
  font-weight: 700;
  color: var(--accent);
  white-space: nowrap;
  padding-top: 2px;
}
.question-text {
  font-size: 0.85rem;
  flex: 1;
}
.new-badge {
  display: inline-block;
  font-size: 0.6rem;
  font-weight: 700;
  color: #000;
  background: var(--amber);
  padding: 1px 7px;
  border-radius: 10px;
  white-space: nowrap;
}

/* ── Expand Toggles ── */
.expand-row {
  display: flex;
  gap: 12px;
  margin-bottom: 8px;
}
.expand-btn {
  font-size: 0.7rem;
  color: var(--text-muted);
  background: none;
  border: none;
  cursor: pointer;
  text-decoration: underline;
  text-decoration-style: dotted;
  transition: color 0.2s;
}
.expand-btn:hover { color: var(--cyan); }
.expand-content {
  display: none;
  font-size: 0.8rem;
  color: var(--text-secondary);
  background: var(--bg-secondary);
  border-radius: var(--radius);
  padding: 10px 12px;
  margin-bottom: 8px;
  border-left: 2px solid var(--accent);
}
.expand-content.show { display: block; }
.expand-label {
  font-size: 0.65rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  color: var(--text-muted);
  margin-bottom: 4px;
}

/* ── Textarea / Input ── */
.question-input {
  width: 100%;
  background: var(--bg-input);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  color: var(--text);
  padding: 10px;
  font-size: 0.85rem;
  font-family: inherit;
  resize: vertical;
  min-height: 60px;
  transition: border-color 0.2s;
}
.question-input:focus {
  outline: none;
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.question-input::placeholder { color: var(--text-muted); }
select.question-input {
  min-height: unset;
  cursor: pointer;
}

/* ── Audit Modal ── */
.audit-modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  max-width: 700px;
  width: 95%;
  max-height: 80vh;
  display: flex;
  flex-direction: column;
}
.audit-modal h3 { margin-bottom: 4px; font-size: 1rem; }
.audit-modal .audit-subtitle {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-bottom: 16px;
}
.audit-table-wrap {
  overflow-y: auto;
  flex: 1;
  margin-bottom: 16px;
}
.audit-table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.78rem;
}
.audit-table th {
  text-align: left;
  padding: 8px 10px;
  border-bottom: 1px solid var(--border);
  color: var(--text-muted);
  font-size: 0.7rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  position: sticky;
  top: 0;
  background: var(--bg-card);
}
.audit-table td {
  padding: 6px 10px;
  border-bottom: 1px solid var(--border);
  color: var(--text-secondary);
  vertical-align: top;
}
.audit-table tr:hover td { background: var(--bg-card-hover); }
.audit-type {
  display: inline-block;
  font-size: 0.65rem;
  font-weight: 700;
  padding: 1px 7px;
  border-radius: 10px;
  white-space: nowrap;
}
.audit-type.login { background: var(--accent); color: #fff; }
.audit-type.answer { background: var(--green); color: #fff; }
.audit-type.scope { background: var(--cyan); color: #000; }
.audit-type.load { background: var(--amber); color: #000; }
.audit-type.reset { background: var(--red); color: #fff; }
.audit-type.export { background: var(--text-muted); color: #fff; }
.audit-empty {
  text-align: center;
  padding: 32px;
  color: var(--text-muted);
  font-size: 0.85rem;
}

/* ── Modal ── */
.modal-overlay {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 1000;
  justify-content: center;
  align-items: center;
}
.modal-overlay.show { display: flex; }
.modal {
  background: var(--bg-card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  padding: 24px;
  max-width: 400px;
  width: 90%;
}
.modal h3 { margin-bottom: 12px; font-size: 1rem; }
.modal p { font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 20px; }
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
}

/* ── Responsive ── */
@media (max-width: 768px) {
  .header-top { flex-direction: column; align-items: stretch; }
  .header-controls { flex-wrap: wrap; }
  .customer-display { max-width: 100%; }
  .summary-bar { grid-template-columns: repeat(2, 1fr); }
  .expand-row { flex-direction: column; gap: 4px; }
  .gate-modal { padding: 24px; }
}
@media (max-width: 480px) {
  .summary-bar { grid-template-columns: 1fr; }
  .header { padding: 12px 12px; }
  .main-content { padding: 12px 12px 48px; }
  .tabs-container { padding: 0 12px 12px; }
}
</style>
</head>
<body>

<!-- ── Gate Modal ── -->
<div class="gate-overlay" id="gateOverlay">
  <div class="gate-modal">
    <h2>ITAM ICQ</h2>
    <div class="subtitle">Implementation &amp; Configuration Questionnaire</div>
    <label for="gateUserName">Your Name</label>
    <input type="text" class="gate-input" id="gateUserName" placeholder="Enter your name..." autofocus />
    <label for="gateCustomerName" style="margin-top:12px">Customer Name</label>
    <input type="text" class="gate-input" id="gateCustomerName" placeholder="Enter customer name..." />
    <div class="gate-error" id="gateError"></div>
    <div class="gate-toggle-label">Deployment Type</div>
    <div class="gate-toggle-container">
      <button class="gate-toggle-btn active" data-gmode="onprem" onclick="setGateMode('onprem')">On-Prem</button>
      <button class="gate-toggle-btn" data-gmode="saas" onclick="setGateMode('saas')">SaaS</button>
    </div>
    <div class="gate-actions">
      <button class="gate-start-btn" onclick="startICQ()">Start Questionnaire</button>
      <div class="gate-divider">or</div>
      <button class="gate-load-btn" onclick="document.getElementById('gateLoadFile').click()">Load Saved Progress</button>
      <input type="file" class="hidden-input" id="gateLoadFile" accept=".json" onchange="loadProgressFile(this, true)" />
    </div>
  </div>
</div>

<!-- ── App Wrapper ── -->
<div class="app-wrapper" id="appWrapper">

<!-- ── Header ── -->
<div class="header">
  <div class="header-top">
    <div class="header-brand">
      <h1>ITAM ICQ</h1>
      <span class="version">v2.0</span>
    </div>
    <div class="header-controls">
      <span class="customer-display" id="customerDisplay"></span>
      <div class="toggle-container">
        <button class="toggle-btn active" data-mode="onprem" onclick="setMode('onprem')">On-Prem</button>
        <button class="toggle-btn" data-mode="saas" onclick="setMode('saas')">SaaS</button>
      </div>
      <button class="btn btn-green" onclick="saveProgress()">&#x1f4be; Save Progress</button>
      <button class="btn" onclick="document.getElementById('loadFileInput').click()">Load</button>
      <input type="file" class="hidden-input" id="loadFileInput" accept=".json" onchange="loadProgressFile(this, false)" />
      <button class="btn" onclick="showAuditModal()">Audit Log</button>
      <button class="btn btn-accent" onclick="exportJSON()">&#x2913; Export</button>
      <button class="btn btn-danger" onclick="showResetModal()">Reset</button>
      <span class="save-indicator" id="saveIndicator">Saved</span>
    </div>
  </div>
</div>

<!-- ── Summary Cards ── -->
<div class="summary-bar">
  <div class="summary-card">
    <div class="label">Total Questions</div>
    <div class="value cyan" id="statTotal">0</div>
  </div>
  <div class="summary-card">
    <div class="label">Answered</div>
    <div class="value green" id="statAnswered">0</div>
  </div>
  <div class="summary-card">
    <div class="label">Remaining</div>
    <div class="value amber" id="statRemaining">0</div>
  </div>
  <div class="summary-card">
    <div class="label">Progress</div>
    <div class="value accent" id="statProgress">0%</div>
  </div>
</div>

<!-- ── Progress Bar ── -->
<div class="progress-bar-container">
  <div class="progress-bar-outer">
    <div class="progress-bar-fill" id="progressBarFill" style="width:0%"></div>
  </div>
</div>

<!-- ── Tabs ── -->
<div class="tabs-container">
  <button class="tab-btn active" data-tab="full" onclick="setTab('full')">Full ICQ <span class="badge" id="tabFullCount">0</span></button>
  <button class="tab-btn" data-tab="new" onclick="setTab('new')">New Questions <span class="badge" id="tabNewCount">0</span></button>
</div>

<!-- ── Main Content ── -->
<div class="main-content" id="mainContent"></div>

<!-- ── Reset Modal ── -->
<div class="modal-overlay" id="resetModal">
  <div class="modal">
    <h3>Reset All Responses?</h3>
    <p>This will permanently clear all answers, customer name, and saved preferences. This cannot be undone.</p>
    <div class="modal-actions">
      <button class="btn" onclick="hideResetModal()">Cancel</button>
      <button class="btn btn-danger" onclick="doReset()">Reset Everything</button>
    </div>
  </div>
</div>

<!-- ── Audit Log Modal ── -->
<div class="modal-overlay" id="auditModal">
  <div class="audit-modal">
    <h3>Audit Log</h3>
    <div class="audit-subtitle">Tracks logins, answer changes, and actions</div>
    <div class="audit-table-wrap" id="auditTableWrap"></div>
    <div class="modal-actions">
      <button class="btn" onclick="exportAuditLog()">Download CSV</button>
      <button class="btn" onclick="hideAuditModal()">Close</button>
    </div>
  </div>
</div>

</div><!-- /app-wrapper -->

<script>
/* ═══════════════════════════════════════════════
   ICQ DATA - All sections and questions
   ═══════════════════════════════════════════════ */
const ICQ_DATA = {
  meta: {
    title: "ITAM Implementation & Configuration Questionnaire",
    version: "2.0",
    lastUpdated: "2026-02-13"
  },
  sections: [
    /* ─── 6.x ABOUT YOU ─── */
    {
      id: "6.1", title: "Organizational Structure", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.1.1", text: "Please provide a list of your primary geographic locations.", whyRelevant: "Understand overall structure of the organization.", exampleResponse: "US: Chicago, New York, Atlanta\nUK: London, Manchester\nAMER / EMEA / APAC", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.1.2", text: "If you have any datacentres, please provide the following information for each:\n- Name\n- Location\n- Size (number of servers)\n- Description", whyRelevant: "Understand overall structure of the organization.", exampleResponse: "Name: Chicago DC1\nLocation: Chicago\nSize: 500 Servers (Physical and Virtual)\nDescription: Primary US Datacentre", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.1.3", text: "Does your organization function as a single entity, or do you have multiple business units or departments that work independently (e.g. each having their own IT function)?", whyRelevant: "Understand overall structure of the organization and how the project is to engage.", exampleResponse: "We have 2 business units that operate independently from each other, distributed across all listed locations.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.1.4", text: "Where you have individual business units/departments operating with some level of autonomy, please provide for each:\n- Business Unit name\n- Description\n- Estimated number of assets\n- Level of autonomy\n- Business Unit owner contact details", whyRelevant: "Understand overall structure of the organization. The autonomy information helps determine if separate project streams are needed.", exampleResponse: "Business Unit Name: AnyCo Manufacturing\nDescription: Manufacturing side of the business\nEstimated assets: 5,000\nAutonomy: Functions as totally independent business with own IT team\nContact: John Smith, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "6.2", title: "Number & Type of Devices", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.2.1", text: "Target number of Windows Servers?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "4,500", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.2", text: "Please provide a technical contact for Windows Servers.", whyRelevant: "Someone who understands how these servers are managed within your estate.", exampleResponse: "John Smith, Windows Server Administrator, john.smith@anyco.com, Tel: (555) 123 4567", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.3", text: "Please provide the FQDN of a sample Windows Server that will be used to confirm the operability of agentless inventory.", whyRelevant: "The server provided here will be used to confirm the agentless inventory capability of the solution is fully operational.", exampleResponse: "winserv01.anyco.local", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.4", text: "Target number of Windows Workstations?", whyRelevant: "To provide a common understanding of the number of devices in your IT estate.", exampleResponse: "27,575", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.5", text: "Please provide a technical contact for Windows Workstations.", whyRelevant: "Someone who understands how workstations are managed within your estate.", exampleResponse: "John Smith, Desktop Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.6", text: "Certero would typically use the capability within the solution to deploy the Client Agent. Please confirm this is acceptable or if you prefer to use another 3rd party tool for agent deployment.", whyRelevant: "To understand how you intend to deploy the Certero Client agent - using the inbuilt capability of Certero, or using a 3rd party tool such as SCCM.", exampleResponse: "Using Certero is acceptable", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.7", text: "Do you use VDI for workstations?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.8", text: "If you use VDI, do you have persistent or non-persistent VDI?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "Persistent", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.9", text: "Do you use any Thin Client devices?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.10", text: "If you use Thin Client devices, how many do you have and what are their manufacturers?", whyRelevant: "To provide an understanding of your desktop infrastructure.", exampleResponse: "350 x Wyse, 100 x HP", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.11", text: "Do you have any internet-based devices that are in scope of the solution?", whyRelevant: "The solution can have a specific Endpoint Server to capture any devices such as remote or mobile workers that connect over the internet.", exampleResponse: "Yes, AWS and Azure are in scope of this engagement.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.12", text: "How many Linux systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "1,320", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.13", text: "Please provide a technical contact for Linux systems.", whyRelevant: "Someone who understands how Linux systems are managed within your estate.", exampleResponse: "John Smith, Linux Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.14", text: "Please provide the FQDN & IP address of a sample Linux system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "linuxserv01.anyco.local / 192.168.20.1", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.15", text: "How many Solaris systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "25", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.16", text: "Please provide a technical contact for Solaris systems.", whyRelevant: "Someone who understands how Solaris systems are managed within your estate.", exampleResponse: "John Smith, Solaris Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.17", text: "Please provide the FQDN & IP address of a sample Solaris system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "solserv01.anyco.local / 192.168.20.2", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.18", text: "How many HP-UX systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "20", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.19", text: "Please provide a technical contact for HP-UX systems.", whyRelevant: "Someone who understands how HP-UX systems are managed within your estate.", exampleResponse: "John Smith, HP Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.20", text: "Please provide the FQDN & IP address of a sample HP-UX system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "hpuxserv01.anyco.local / 192.168.20.3", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.21", text: "How many AIX systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "42", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.22", text: "Please provide a technical contact for AIX systems.", whyRelevant: "Someone who understands how AIX systems are managed within your estate.", exampleResponse: "John Smith, IBM Server Administrator, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.23", text: "Please provide the FQDN & IP address of a sample AIX system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "aixserv01.anyco.local / 192.168.20.4", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.24", text: "For any non-Windows systems, are you able to provide an RSA key for authentication?", whyRelevant: "RSA key-based authentication is the most efficient method of obtaining inventory of non-Windows based systems.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.25", text: "How many macOS systems do you have?", whyRelevant: "To provide a common understanding of the number & type of devices you have.", exampleResponse: "250", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.2.26", text: "Please provide a technical contact for macOS systems.", whyRelevant: "Someone who understands how macOS systems are managed within your estate.", exampleResponse: "John Appleseed, Apple System Administrator, john.appleseed@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.2.27", text: "Please provide the FQDN & IP address of a sample macOS system that will be used to confirm inventory operability.", whyRelevant: "This system will be used to confirm the inventory capability of the solution is fully operational on this type of system.", exampleResponse: "macos01.anyco.local / 192.168.20.5", scope: "both", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "6.3", title: "Active Directory", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.3.1", text: "For each Active Directory domain, please provide:\n- Active Directory Domain Name (NetBIOS Name)\n- DNS Domain Name\n- Two Domain Controllers\n\nWe will require an Active Directory (AD) user account for each AD domain.", whyRelevant: "Active Directory connectors are needed for each domain to discover and inventory computers and users.", exampleResponse: "Domain Name: JONES\nDNS Domain: jones.local\nControllers: J-DC01, J-DC02\n\nDomain Name: APPLESEED\nDNS Domain: appleseed.com\nControllers: A-DC01, A-DC02", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.3.2", text: "Do you use Azure Active Directory (Entra ID) in addition to on-premises Active Directory?", whyRelevant: "Azure AD / Entra ID connectivity enables cloud-based user and device discovery.", exampleResponse: "Yes, we use Azure AD with hybrid join.", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "6.3.3", text: "If using Azure AD, please provide the Tenant ID and primary domain.", whyRelevant: "Required to configure the Azure AD connector for user and device synchronization.", exampleResponse: "Tenant ID: bf5c98bb-bc86-4550-bbe1-d3c3629b01dc\nPrimary domain: anyco.onmicrosoft.com", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "6.4", title: "Email", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.4.1", text: "Do you use Office 365 for mail?", whyRelevant: "Will feed into the solution design and any required prerequisites.", exampleResponse: "No", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.4.2", text: "Do you have any on-premise Exchange server infrastructure?", whyRelevant: "Will feed into the solution design and any required prerequisites.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.4.3", text: "If you have an on-premise Exchange server, please provide the server name.", whyRelevant: "This will be used to help create a connector to your Exchange server.", exampleResponse: "ex01.anyco.local", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.4.4", text: "If you have an on-premise Exchange server, please confirm the Exchange Server has an Information Store.", whyRelevant: "This is required for the connector to function correctly.", exampleResponse: "Yes, it has been configured with access to an Information Store.", scope: "both", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "6.5", title: "Virtualization", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.5.1", text: "Please provide the names of each VMware vCenter servers you have.", whyRelevant: "We will require an Active Directory User account with the Read Role to each VMware vCenter server.", exampleResponse: "vc01.anyco.local\nvc02.anyco.local\nvc03.anyco.local", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.5.2", text: "Please provide the names of each standalone ESX server you have. Do not include any that are already managed by a vCentre server in your response above.", whyRelevant: "For standalone ESX servers, only the root account can be used to ensure the right information is obtained.", exampleResponse: "esx01.anyco.local\nesx02.anyco.local", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.5.3", text: "Do you have any other Virtualization technology? If yes, which ones?", whyRelevant: "To provide an understanding of your virtualization infrastructure.", exampleResponse: "oVirt, Oracle VM, IBM AIX (HMC)", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.5.4", text: "Please provide technical contacts for each of your Virtualization technologies.", whyRelevant: "Those who understand and manage your virtualization technologies within your estate.", exampleResponse: "VMware: John Smith, VMware Administrator, john.smith@anyco.com\noVirt: Jane Doe, oVirt Administrator, jane.doe@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.5.5", text: "Do you use Nutanix AHV for virtualization? If so, provide the Prism Central address and number of clusters.", whyRelevant: "Certero has a native Nutanix connector that discovers VMs, hosts and clusters via the Prism REST API.", exampleResponse: "Yes, Prism Central: prism.anyco.local, 3 clusters, ~200 VMs", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "6.5.6", text: "Do you use Citrix XenServer / Citrix Hypervisor? If so, provide pool master addresses.", whyRelevant: "Certero has a native XenServer connector that discovers hosts and VMs via the XAPI.", exampleResponse: "Yes, 2 pools: xenpool01.anyco.local, xenpool02.anyco.local", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "6.5.7", text: "Do you use oVirt / Red Hat Virtualization? If so, provide the oVirt Engine address.", whyRelevant: "Certero has a native oVirt/RHV connector that discovers clusters and VMs via the oVirt REST API.", exampleResponse: "Yes, ovirt-engine.anyco.local, 4 clusters", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "6.6", title: "Network Infrastructure", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.6.1", text: "Approximately how many network subnets do you have?", whyRelevant: "To provide an understanding of your network structure.", exampleResponse: "125", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.6.2", text: "Provide details of any internal networks or VLANs that are firewalled, for example, connectivity across the networks is blocked for default ports.", whyRelevant: "To provide an understanding of your network structure in terms of any environments that have restricted network access for which additional firewall ports may need to be opened.", exampleResponse: "Network Name: DMZ\nNetwork: 10.17.21.0\nSubnet Mask: 255.255.255.0\nRestrictions: All inbound traffic blocked, exceptions managed by firewall rule", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.6.3", text: "Please provide a contact for Network infrastructure planning and changes.", whyRelevant: "Someone who knows the network architecture and can ensure any required network changes are managed and executed.", exampleResponse: "John Smith, Network Administrator, john.smith@anyco.com, Tel: (555) 123 4567", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.6.4", text: "For Unix and Linux based computers, the solution uses TCP port 22 for Network Discovery. Please confirm the port (or ports) to be used.", whyRelevant: "To allow Network Discovery of Unix and Linux computers.", exampleResponse: "Port 22 is fine", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.6.5", text: "Do you have SNMP-manageable network devices (switches, routers, printers, UPS, etc.)? If so, approximately how many?", whyRelevant: "Certero can discover and inventory SNMP-enabled network devices to provide complete visibility.", exampleResponse: "Yes, approximately 500 managed switches and 50 routers", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "6.7", title: "Information Security", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.7.1", text: "Do you have any legacy Windows Servers & Desktops? (Windows 2003, XP, 2008, 2003)", whyRelevant: "These legacy systems impact the SSL Certificate requirement. Checking your Active Directory for older legacy Windows systems will help answer this question.", exampleResponse: "No", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.7.2", text: "Please confirm you are able to provide SSL Certificates.", whyRelevant: "Without valid SSL Certificates, the solution will not be able to securely communicate over HTTPS.", exampleResponse: "Yes, certificates are issued by our internal CA.", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "6.8", title: "Patch Management", category: "about-you",
      scope: "both", conditional: true, conditionalLabel: "Patch Management in scope",
      questions: [
        { ref: "6.8.1", text: "What patch management tools do you currently use for Windows systems?", whyRelevant: "Understanding existing patch management infrastructure helps plan the Certero Patch Management module integration.", exampleResponse: "WSUS and SCCM for Windows patching, manual process for Linux", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "6.8.2", text: "How many WSUS servers do you have and what are their FQDNs?", whyRelevant: "Required to configure the Certero Patch Management connector to synchronize with your WSUS infrastructure.", exampleResponse: "2 servers: wsus01.anyco.local, wsus02.anyco.local", scope: "onprem", isNew: true, inputType: "textarea" },
        { ref: "6.8.3", text: "Do you have a defined patch cycle (e.g. monthly Patch Tuesday, quarterly)?", whyRelevant: "Helps align Certero patch reporting schedules with your existing patch windows.", exampleResponse: "Monthly, aligned with Microsoft Patch Tuesday + 7 days for testing", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "6.8.4", text: "Do you patch Linux/Unix systems? If so, what tools and repositories are used?", whyRelevant: "Understanding Linux patch infrastructure helps plan comprehensive patch visibility.", exampleResponse: "Yes, using Ansible with local RHEL Satellite repositories", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "6.9", title: "Input into Project Planning", category: "about-you",
      scope: "both", conditional: false,
      questions: [
        { ref: "6.9.1", text: "Will you be assigning a Project Manager to the Implementation and Configuration and if so, can you provide their contact details?", whyRelevant: "So we know if you will have a Project Manager in place and who to liaise with.", exampleResponse: "John Smith, Project Manager, john.smith@anyco.com, Tel: (555) 123 4567", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.2", text: "Please provide an escalation point for the project.", whyRelevant: "If any issues need escalating, we will have a contact for communication.", exampleResponse: "John Smith, Program Manager, john.smith@anyco.com", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.3", text: "Will any members of the Certero delivery team need to go through any security clearance processes before starting the project?", whyRelevant: "To understand if this will be a prerequisite before activities can commence.", exampleResponse: "No special security clearances required", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.4", text: "What is the lead time for a change request to be approved?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "7 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.5", text: "Which day of the week is the deadline for submitting change requests?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "Wednesday of each week", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.6", text: "When are your planned change freeze dates?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "Public Holiday: 25-Jun-2025\nEaster\nChristmas period (Dec 20 - Jan 2)", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.7", text: "Are there any internal deadlines you are working towards that we need to be aware of?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "We have a Microsoft EA renewal due 25-Jun-2025", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.8", text: "Are there any other priority projects that could impact the Certero delivery that should be considered?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "Project 'Secret Squirrel' that completes in 4 weeks will require the same resources", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.9", text: "Is any of your IT outsourced, and if so, which parts?", whyRelevant: "To help understand if your team needs to interact with a 3rd party organization.", exampleResponse: "Yes. Our IBM servers are managed by AnyCo Server Management Inc.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.10", text: "Do you have any parts of the business that fall under different management?", whyRelevant: "To help us understand if we need to engage multiple teams for the project.", exampleResponse: "Yes. Our business unit in France is managed separately.", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.11", text: "What time zones do your teams operate in?", whyRelevant: "So this can be factored into the planning.", exampleResponse: "EST & GMT", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.12", text: "Provide up to two currencies you would like to use with the solution, confirming which is to be used as your primary currency.", whyRelevant: "To help define one or more currencies within the solution as part of its implementation.", exampleResponse: "US$ (Primary currency) and GBP", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.13", text: "The solution has the ability to highlight any new computers found on your network for a number of days - how many days should this be?", whyRelevant: "To be used during the configuration of the solution.", exampleResponse: "7 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.14", text: "The solution has the ability to highlight 'expired' computers, which are those not seen by the solution after a number of days - how many days should this be?", whyRelevant: "To be used during the configuration of the solution.", exampleResponse: "30 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.15", text: "The solution has the ability to auto-archive computers not seen by the solution after a pre-defined number of days - how many days should this be?", whyRelevant: "To be used during the configuration of the solution.", exampleResponse: "90 days", scope: "both", isNew: false, inputType: "text" },
        { ref: "6.9.16", text: "Who do you see as being the main user(s) of the solution? For each, provide their full name, their role and the login username to be used.", whyRelevant: "This will help with the setting up of the initial users of the solution.", exampleResponse: "John Smith, Software Asset Manager, jsmith01\nJohn Appleseed, Desktop Engineer, jappleseed02", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "6.9.17", text: "For the main solution users identified above, they can be authenticated by:\n- Local account within the solution\n- Via an on-premise Active Directory\n- Via Azure Active Directory\n- Via Federated Active Directory\nWhich method do you wish to use?", whyRelevant: "This will help with the setting up of the initial users of the solution.", exampleResponse: "Azure Active Directory", scope: "both", isNew: false, inputType: "text" }
      ]
    },

    /* ─── 7.x ABOUT THE SOLUTION ─── */
    {
      id: "7.1", title: "Application Server", category: "about-solution",
      scope: "onprem", conditional: false,
      questions: [
        { ref: "7.1.1", text: "The solution will have an Application Server. Please provide a static IPv4 address.", whyRelevant: "The IP address will need to be added to DNS.", exampleResponse: "192.168.10.22", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.1.2", text: "Please provide a FQDN or alias that you would like to use for the main solution website.", whyRelevant: "This will be used by users to access the solution from their browser and needs to be added to DNS.", exampleResponse: "certero.anyco.local", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.1.3", text: "On the Application Server there will be a secondary website for Certero Provisioning. What should the site name be?", whyRelevant: "This will be used in conjunction with the port number to access the Certero Provisioning website.", exampleResponse: "certeroprov.anyco.local", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.1.4", text: "A secondary website (Certero Provisioning) on the Application Server uses port 9000 by default for access. If this is not acceptable, which other port should be used?", whyRelevant: "Needed as part of the installation of Certero Provisioning on the Application Server so its website can be accessed.", exampleResponse: "Port 9000 is fine to use on the Application Server", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.1.5", text: "Please provide the email address and the name of an individual who should have access to Certero Provisioning.", whyRelevant: "This user will be set up as your initial user of Certero Provisioning.", exampleResponse: "john.smith@anyco.com, John Smith", scope: "onprem", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "7.2", title: "Database Server", category: "about-solution",
      scope: "onprem", conditional: false,
      questions: [
        { ref: "7.2.1", text: "The Database uses Microsoft SQL Server. The supported versions are Microsoft SQL Server 2016 or greater, Standard or Enterprise Edition. What version and edition of Microsoft SQL Server will be used?", whyRelevant: "Will be incorporated into the solution design and any related prerequisites.", exampleResponse: "2019 Standard Edition", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.2.2", text: "Certero recommends that a dedicated instance of SQL Server is used to support Certero. Will the SQL Server be a shared or dedicated instance?", whyRelevant: "Will be incorporated into the solution design and any related prerequisites.", exampleResponse: "Dedicated", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.2.3", text: "SQL Server and the Application Server must be members of the same Active Directory Domain. Which domain will this be?", whyRelevant: "To ensure the two solution components can communicate.", exampleResponse: "Both will be on AD domain ANYCO", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.2.4", text: "For SQL Server will you use a Default Instance, or a Named Instance?", whyRelevant: "Will be incorporated into the solution design and any related prerequisites.", exampleResponse: "Named Instance", scope: "onprem", isNew: false, inputType: "text" },
        { ref: "7.2.5", text: "If you use a Named Instance, then please confirm the dynamic port range that will be used.", whyRelevant: "SQL Server may be configured to use Dynamic Ports. If this is the case, a range of ports will need to be opened.", exampleResponse: "Ports 45200 to 45250", scope: "onprem", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "7.3", title: "Certero Client Agent", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "7.3.1", text: "Please confirm your preference to use agent-based or agentless inventory of your Windows workstations.", whyRelevant: "To help configure inventory within the solution aligned to your preference.", exampleResponse: "Agent-based", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.3.2", text: "Please confirm your preference to use agent-based or agentless inventory of your Windows servers.", whyRelevant: "To help configure inventory within the solution aligned to your preference.", exampleResponse: "Agentless", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.3.3", text: "For those computers having the Certero Client Agent installed, it can be configured to show or hide its icon in the system tray area. Do you want this to be shown or hidden to end users?", whyRelevant: "Will be incorporated into the solution design.", exampleResponse: "Show", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.3.4", text: "The Client Agent has an auto-update capability for ease of on-going operational maintenance. Should this capability be enabled or disabled?", whyRelevant: "Will be incorporated into the solution design.", exampleResponse: "Enable", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.3.5", text: "The Client Agent can run a small web server on each endpoint computer to help diagnose and troubleshoot issues. Please confirm if this is a capability you wish to enable, and if so, which unique port to use and whether HTTP or HTTPS should be used.", whyRelevant: "This allows users of the solution to look at Certero log files on the computer where the Client Agent is installed and make use of optional plug-in tools.", exampleResponse: "HTTPS, port 27738", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "7.3.6", text: "For this Implementation & Configuration of the solution, the Client Agent will be deployed to a sample of up to 10 workstations. Please provide a list of the FQDNs of these sample workstations.", whyRelevant: "The list of these workstations will be used during the implementation to confirm the operability of the Certero Client Agent.", exampleResponse: "workstation01.anyco.local\nworkstation02.anyco.local\nworkstation03.anyco.local", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "7.4", title: "Networks", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "7.4.1", text: "Please provide a list of networks by completing the Network Definitions Template (or provide equivalent information):\n- Network Name\n- Network Address\n- Subnet Mask\n- Location\n- Description", whyRelevant: "This will be used to import your network definitions into the solution and enable asset Discovery to occur.", exampleResponse: "See attached Network Definitions spreadsheet, covering 125 subnets across all locations.", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "7.5", title: "Information Security", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "7.5.1", text: "Will you be using Anti-Virus software on the Application Server, Database Server and/or Endpoint Server solution components?", whyRelevant: "If Anti-Virus is used, best practice is to add exceptions so as to not impact performance of the solution.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.5.2", text: "Do you use a proxy server to access the internet?", whyRelevant: "Proxy server details will be required for Certero Provisioning to correctly synchronize with the Customer Centre.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.5.3", text: "Certero Provisioning on the Application Server can 'pull' updates such as SRDB definitions automatically securely over the internet using HTTPS port 443. This will be enabled by default. Please confirm this is acceptable.", whyRelevant: "To allow Certero Provisioning to communicate with the Certero Customer Center (cc.certero.com) to receive License Activations, download new releases and enable automatic SRDB synchronization.", exampleResponse: "OK", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.5.4", text: "Within your network, secure HTTPS traffic between solution components uses port 443. If this is not the port you use, which other port should be used for HTTPS?", whyRelevant: "To ensure the secure communication between all solution components over HTTPS.", exampleResponse: "Yes, use port 443", scope: "both", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "7.6", title: "Email & Alerting", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "7.6.1", text: "What is the SMTP email relay server name the solution can use?", whyRelevant: "Used to allow the Certero solution to send emails to its users such as reports and automated alerts.", exampleResponse: "smtp.office365.com (Office 365) or smtp01.anyco.com (On-premise)", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.6.2", text: "The typical ports for an SMTP server will be 587 or 25. Please confirm which port should be used.", whyRelevant: "Used to allow the Certero solution to send emails to its users.", exampleResponse: "Port 587 (Office 365) or Port 25 (On-premise)", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.6.3", text: "What authentication type is used with the SMTP Email server: Anonymous or Basic?", whyRelevant: "To know which method of authentication is to be used and if credentials are to be provided.", exampleResponse: "Basic", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.6.4", text: "For emailed alerts from the solution, confirm the 'sender' email address and the name you wish to use.", whyRelevant: "Emails from the solution will be sent from the sender email address and name provided.", exampleResponse: "noreply@certero.anyco.com, Certero Platform", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "7.6.5", text: "Does your SMTP email relay server require the sending server to be 'approved' or on a 'whitelist' to allow the solution to make use of it?", whyRelevant: "This may be required before the solution can send emails and alerts using your email infrastructure.", exampleResponse: "Yes, the solution will need to be added to an approved list of senders.", scope: "both", isNew: false, inputType: "text" }
      ]
    },
    {
      id: "7.7", title: "Certero Customer Centre", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "7.7.1", text: "Provide email address, name, primary telephone number and (optionally) a secondary telephone number for each Technical Contact requiring access to the Certero Customer Centre.", whyRelevant: "The user accounts for these Technical Contacts (as defined within the Technical Support Policy) will be created.", exampleResponse: "John Smith, john.smith@anyco.com, (555) 123 4567\nJohn Appleseed, john.appleseed@anyco.com, (555) 765 4321", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "7.8", title: "Distribution", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Distribution in scope",
      questions: [
        { ref: "7.8.1", text: "Do you use SCCM/MECM for software distribution? If so, please provide the SCCM server FQDN.", whyRelevant: "The Certero Distribution connector integrates with SCCM to provide software distribution capabilities.", exampleResponse: "Yes, sccm01.anyco.local", scope: "onprem", isNew: false, inputType: "textarea" },
        { ref: "7.8.2", text: "What other software distribution tools do you use (e.g. Intune, BigFix, PDQ Deploy)?", whyRelevant: "Understanding your distribution landscape helps plan the integration approach.", exampleResponse: "BigFix for servers, Intune for cloud-managed workstations", scope: "both", isNew: false, inputType: "textarea" }
      ]
    },
    {
      id: "7.9", title: "Application Monitoring", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Application Monitoring in scope",
      questions: [
        { ref: "7.9.1", text: "By default, the Application Monitoring module will be enabled on all workstations. Confirm if there are to be any exceptions to this approach, and what they are.", whyRelevant: "This will be taken into consideration as part of the implementation and configuration of the solution.", exampleResponse: "No exceptions - deploy to all user workstations", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "7.9.2", text: "Are there specific applications you want to prioritize for monitoring (e.g. high-cost software, security-critical applications)?", whyRelevant: "Helps focus the Application Monitoring configuration on the most valuable targets.", exampleResponse: "Microsoft Office, Adobe Creative Cloud, AutoCAD, MATLAB", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.10", title: "Patch Management", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Patch Management in scope",
      questions: [
        { ref: "7.10.1", text: "Do you want Certero to provide patch compliance reporting across your Windows estate?", whyRelevant: "Certero Patch Management provides visibility into patch compliance status across all managed Windows systems.", exampleResponse: "Yes, we need compliance reporting for audit purposes", scope: "both", isNew: false, inputType: "textarea" },
        { ref: "7.10.2", text: "If On-Prem: Please provide the FQDN(s) of your WSUS server(s) for patch synchronization.", whyRelevant: "Required to configure the Certero Patch Management integration with your WSUS infrastructure.", exampleResponse: "wsus01.anyco.local, wsus02.anyco.local", scope: "onprem", isNew: false, inputType: "textarea" },
        { ref: "7.10.3", text: "Do you require patch compliance data to be integrated with any other tools or dashboards?", whyRelevant: "Understanding downstream reporting requirements helps plan the implementation.", exampleResponse: "Yes, we export patch compliance data into ServiceNow monthly", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.11", title: "SNMP Network Discovery", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "SNMP Discovery in scope",
      questions: [
        { ref: "7.11.1", text: "Do you want to use SNMP-based network discovery to find and inventory network devices (switches, routers, printers, etc.)?", whyRelevant: "Certero supports SNMP v1/v2c/v3 for discovering and inventorying network infrastructure devices.", exampleResponse: "Yes, we want to discover all managed switches and routers", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.11.2", text: "Which SNMP version(s) do you use: v1, v2c, or v3?", whyRelevant: "Different SNMP versions require different configuration (community strings for v1/v2c, credentials for v3).", exampleResponse: "SNMP v2c for most devices, v3 for core switches", scope: "both", isNew: true, inputType: "text" },
        { ref: "7.11.3", text: "If using SNMP v1/v2c, what community string(s) are configured on your network devices?", whyRelevant: "Community strings are required for the SNMP connector to authenticate with network devices.", exampleResponse: "Read-only community string: 'public' (we will change this before go-live)", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.11.4", text: "If using SNMP v3, please provide the authentication and privacy details:\n- Username\n- Authentication protocol (MD5/SHA)\n- Privacy protocol (DES/AES)", whyRelevant: "SNMP v3 requires authentication credentials for secure device access.", exampleResponse: "Username: certero-ro\nAuth: SHA\nPrivacy: AES128", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.11.5", text: "Which network ranges should be scanned for SNMP-enabled devices?", whyRelevant: "Defines the scope of SNMP network discovery to target the correct network segments.", exampleResponse: "10.0.0.0/16 (management VLAN)\n172.16.0.0/12 (infrastructure VLAN)", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.12", title: "SaaS Connectors - Microsoft 365", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Microsoft 365 connector in scope",
      questions: [
        { ref: "7.12.1", text: "Do you have one or more Microsoft 365 tenants? If so, please list the Tenant IDs and primary domains.", whyRelevant: "Each Microsoft 365 tenant requires a separate connector configuration for licence and usage data collection.", exampleResponse: "Tenant ID: abc123-def456\nPrimary domain: anyco.onmicrosoft.com", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.12.2", text: "Can you provide a Global Reader (or equivalent read-only) service account or app registration for the Microsoft Graph API?", whyRelevant: "The Microsoft 365 connector uses Microsoft Graph API to collect user, licence, and mailbox data.", exampleResponse: "Yes, we will create an App Registration with the required Graph API permissions.", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.12.3", text: "Which Microsoft 365 data do you want to collect? (Users, Licences, Mailbox usage, OneDrive usage, Teams usage, SharePoint usage)", whyRelevant: "Helps scope the connector configuration and required API permissions.", exampleResponse: "All of the above - we need full visibility for licence optimization", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.12.4", text: "Do you have any Microsoft 365 E5/E3/E1 licence optimization goals?", whyRelevant: "Understanding your optimization goals helps configure the right reports and dashboards.", exampleResponse: "Yes, we want to identify unused E5 licences that could be downgraded to E3", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.13", title: "SaaS Connectors - Adobe Creative Cloud", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Adobe CC connector in scope",
      questions: [
        { ref: "7.13.1", text: "Do you have an Adobe Admin Console account? Please provide the Organization ID.", whyRelevant: "Required to configure the Adobe Creative Cloud connector for user and licence data collection.", exampleResponse: "Yes, Org ID: 12345ABC@AdobeOrg", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.13.2", text: "Can you provide API credentials (Client ID and Client Secret) from the Adobe Developer Console?", whyRelevant: "The connector uses Adobe's User Management API to collect licence assignment and usage data.", exampleResponse: "Yes, we will create a service account integration in the Adobe Developer Console", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.13.3", text: "How many Adobe named-user licences do you have, and which plans (e.g. All Apps, Single App)?", whyRelevant: "Understanding the licence landscape helps configure appropriate optimization reports.", exampleResponse: "350 All Apps licences, 50 Acrobat Pro DC licences", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.14", title: "SaaS Connectors - Salesforce", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Salesforce connector in scope",
      questions: [
        { ref: "7.14.1", text: "Do you have Salesforce? Please provide the instance URL.", whyRelevant: "Required to configure the Salesforce connector for licence and user data collection.", exampleResponse: "Yes, https://anyco.my.salesforce.com", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.14.2", text: "Can you provide a read-only connected app or API user credentials for the Salesforce REST API?", whyRelevant: "The connector uses the Salesforce REST API to collect user, licence, and login data.", exampleResponse: "Yes, we will create a Connected App with API access", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.14.3", text: "How many Salesforce licences do you have, and which editions/types?", whyRelevant: "Understanding your Salesforce licence landscape helps plan optimization analysis.", exampleResponse: "200 Enterprise licences, 50 Platform licences", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.15", title: "SaaS Connectors - Google Workspace", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Google Workspace connector in scope",
      questions: [
        { ref: "7.15.1", text: "Do you use Google Workspace? Please provide the primary domain and customer ID.", whyRelevant: "Required to configure the Google Workspace connector for user and licence data.", exampleResponse: "Yes, domain: anyco.com, Customer ID: C01234567", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.15.2", text: "Can you create a service account with domain-wide delegation for the Google Admin SDK?", whyRelevant: "The connector requires a service account with appropriate Google Admin SDK scopes to collect data.", exampleResponse: "Yes, our Google admin team can set this up", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.15.3", text: "Which Google Workspace plans are in use (e.g. Business Starter, Business Standard, Enterprise)?", whyRelevant: "Understanding your Google licence types helps configure optimization reporting.", exampleResponse: "Mixture of Business Standard and Enterprise licences", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.16", title: "Microsoft Intune", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Intune connector in scope",
      questions: [
        { ref: "7.16.1", text: "Do you use Microsoft Intune for device management? Approximately how many devices are enrolled?", whyRelevant: "The Intune connector imports managed device data to provide visibility of cloud-managed endpoints.", exampleResponse: "Yes, approximately 5,000 Windows devices and 2,000 mobile devices enrolled", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.16.2", text: "Can you provide an App Registration in Azure AD with the Microsoft Graph API permissions required for Intune device read access?", whyRelevant: "The Intune connector uses Microsoft Graph API to read device and compliance data.", exampleResponse: "Yes, we will create an App Registration with DeviceManagementManagedDevices.Read.All permission", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.16.3", text: "Do you manage both corporate-owned and BYOD devices through Intune?", whyRelevant: "Helps configure the connector to correctly categorize device ownership types.", exampleResponse: "Yes, corporate-owned laptops and BYOD mobile devices", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.17", title: "Cisco Meraki", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Cisco Meraki connector in scope",
      questions: [
        { ref: "7.17.1", text: "Do you use Cisco Meraki for network management? How many networks/sites are managed?", whyRelevant: "The Cisco Meraki connector discovers and inventories network devices managed through the Meraki Dashboard.", exampleResponse: "Yes, 25 sites managed through Meraki Dashboard", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.17.2", text: "Can you provide a Meraki Dashboard API key with read-only organization access?", whyRelevant: "The connector uses the Meraki Dashboard REST API to collect network and device data.", exampleResponse: "Yes, we will generate an API key from the Meraki Dashboard", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.17.3", text: "Which Meraki product types are in use (MX, MS, MR, MV, MT)?", whyRelevant: "Helps scope the connector to collect data for the relevant Meraki product families.", exampleResponse: "MX (security appliances), MS (switches), MR (wireless APs)", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.18", title: "ServiceNow Integration", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "ServiceNow integration in scope",
      questions: [
        { ref: "7.18.1", text: "Do you use ServiceNow? If so, which version and instance URL?", whyRelevant: "Certero can integrate with ServiceNow to synchronize asset data, CMDB records, and licence compliance information.", exampleResponse: "Yes, San Diego release, https://anyco.service-now.com", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.18.2", text: "What is the intended direction of data flow? (Certero to ServiceNow, ServiceNow to Certero, or bidirectional)", whyRelevant: "Determines the integration approach and required ServiceNow API permissions.", exampleResponse: "Certero to ServiceNow - push asset and licence data to populate the CMDB", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.18.3", text: "Can you provide a ServiceNow service account with the appropriate roles for API access?", whyRelevant: "The integration requires API access to read/write ServiceNow tables (e.g. cmdb_ci, alm_asset).", exampleResponse: "Yes, we will create a service account with ITAM roles", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.18.4", text: "Which ServiceNow tables/modules do you want to integrate with (CMDB, SAM, HAM, ITSM)?", whyRelevant: "Helps scope the integration to the relevant ServiceNow modules.", exampleResponse: "CMDB for asset records, SAM Pro for licence compliance", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.19", title: "Oracle Database Connector", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Oracle DB connector in scope",
      questions: [
        { ref: "7.19.1", text: "Do you have Oracle Database installations? How many instances and which editions (Enterprise, Standard, XE)?", whyRelevant: "The Oracle Database connector collects instance, option, and feature usage data critical for Oracle licence compliance.", exampleResponse: "15 Enterprise Edition instances, 5 Standard Edition 2 instances", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.19.2", text: "Can you provide read-only database credentials (or Oracle OCI credentials) for each Oracle instance?", whyRelevant: "The connector requires database-level access to query DBA views for option/feature usage data.", exampleResponse: "Yes, we will create a read-only user with SELECT on DBA_ views", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.19.3", text: "Are any Oracle databases running on virtualized infrastructure (VMware, OVM, etc.)?", whyRelevant: "Oracle licensing on virtual infrastructure has specific rules around soft/hard partitioning that affect compliance calculations.", exampleResponse: "Yes, 8 instances run on VMware, 7 on physical servers", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.19.4", text: "Do you use Oracle RAC, Data Guard, or other Enterprise Edition options?", whyRelevant: "Enterprise options significantly impact licence compliance and cost; the connector detects these automatically.", exampleResponse: "RAC on 3 instances, Data Guard on 2 instances", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.20", title: "IBM ILMT Connector", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "IBM ILMT connector in scope",
      questions: [
        { ref: "7.20.1", text: "Do you use IBM License Metric Tool (ILMT)? What version?", whyRelevant: "The ILMT connector imports PVU consumption data for IBM sub-capacity licence compliance.", exampleResponse: "Yes, ILMT version 9.2.28", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.20.2", text: "Can you provide read-only database credentials for the ILMT database (DB2 or SQL Server)?", whyRelevant: "The connector reads PVU consumption data directly from the ILMT database.", exampleResponse: "Yes, we can create a read-only user on the ILMT DB2 database", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.20.3", text: "How many IBM PVU-licensed products are deployed in your environment?", whyRelevant: "Understanding the scope helps plan the connector configuration and compliance reporting.", exampleResponse: "Approximately 12 PVU-licensed products across 50 servers (WebSphere, MQ, DB2)", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.21", title: "SAP Connector", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "SAP connector in scope",
      questions: [
        { ref: "7.21.1", text: "Do you use SAP? Which products (ECC, S/4HANA, BW, etc.)?", whyRelevant: "The SAP connector collects user, transaction, and licence data via SAP RFC for licence compliance.", exampleResponse: "SAP ECC 6.0, SAP BW, SAP Solution Manager", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.21.2", text: "Can you provide an RFC-enabled service account with the required authorizations for the SAP systems?", whyRelevant: "The connector uses SAP RFC protocol to extract user master data, transaction usage, and licence information.", exampleResponse: "Yes, we will create an RFC user with read-only access to USR*, RFCDES tables", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.21.3", text: "How many SAP named users and engine licences are deployed?", whyRelevant: "Understanding the licence scope helps plan compliance analysis and reporting.", exampleResponse: "3,500 named users across Professional, Limited Professional, and Developer types", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.21.4", text: "What is the SAP Application Server hostname and system number for each system to connect to?", whyRelevant: "Required to configure the SAP RFC connection for each system.", exampleResponse: "PRD: sapprd.anyco.local, System 00\nQAS: sapqas.anyco.local, System 01", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.22", title: "Warranty", category: "about-solution",
      scope: "both", conditional: false,
      questions: [
        { ref: "7.22.1", text: "Do you wish to make use of the Dell Warranty information automatically collected by the solution?", whyRelevant: "The solution can contact Dell systems over the internet to obtain specific warranty information regarding Dell computers.", exampleResponse: "Yes", scope: "both", isNew: false, inputType: "text" },
        { ref: "7.22.2", text: "If enabling Dell warranty lookups, can you provide a Dell TechDirect API key?", whyRelevant: "Dell requires API credentials for automated warranty lookups. A TechDirect account with API access is needed.", exampleResponse: "Yes, we have a Dell TechDirect account and can generate API credentials", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.22.3", text: "Do you wish to enable Lenovo warranty lookups?", whyRelevant: "The solution can also collect warranty data for Lenovo devices via the Lenovo support API.", exampleResponse: "Yes, we have approximately 2,000 Lenovo devices", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.22.4", text: "If enabling Lenovo warranty lookups, can you provide Lenovo API credentials?", whyRelevant: "Lenovo warranty lookups require valid API credentials from the Lenovo support portal.", exampleResponse: "Yes, we will request API credentials from Lenovo", scope: "both", isNew: true, inputType: "textarea" }
      ]
    },
    {
      id: "7.23", title: "Additional Virtualization Platforms", category: "about-solution",
      scope: "both", conditional: true, conditionalLabel: "Additional virtualization connectors in scope",
      questions: [
        { ref: "7.23.1", text: "Do you use Nutanix AHV? If so, provide the Prism Central/Element address and credentials requirements.", whyRelevant: "Certero's Nutanix connector discovers clusters, hosts, and VMs via the Prism REST API for licence compliance.", exampleResponse: "Yes, Prism Central: prism.anyco.local\nWe can provide a read-only Prism user", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.23.2", text: "Do you use oVirt or Red Hat Virtualization (RHV)? If so, provide the Engine URL.", whyRelevant: "The oVirt/RHV connector discovers datacenters, clusters, hosts, and VMs via the oVirt REST API.", exampleResponse: "Yes, oVirt Engine: https://ovirt-engine.anyco.local/ovirt-engine/api", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.23.3", text: "Do you use Citrix XenServer / Citrix Hypervisor? If so, provide the pool master addresses.", whyRelevant: "The XenServer connector discovers pools, hosts, and VMs via the XAPI.", exampleResponse: "2 pools:\nxenpool01.anyco.local\nxenpool02.anyco.local", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.23.4", text: "Do you use Oracle VM Manager? If so, provide the OVM Manager address.", whyRelevant: "The Oracle VM connector discovers server pools, servers, and VMs via the OVM Manager REST API.", exampleResponse: "Yes, ovm-manager.anyco.local", scope: "both", isNew: true, inputType: "textarea" },
        { ref: "7.23.5", text: "Do you have IBM Power Systems managed by an HMC? If so, provide the HMC addresses.", whyRelevant: "The IBM HMC connector discovers managed systems, LPARs, and processor allocations for PVU licence calculations.", exampleResponse: "HMC 1: hmc01.anyco.local (managing 4 Power8 frames)\nHMC 2: hmc02.anyco.local (managing 2 Power9 frames)", scope: "both", isNew: true, inputType: "textarea" }
      ]
    }
  ]
};

/* ═══════════════════════════════════════════════
   APPLICATION STATE
   ═══════════════════════════════════════════════ */
const STORAGE_KEY = 'icq_portal_data';
let gateMode = 'onprem';
let state = {
  templateMode: 'onprem',
  customerName: '',
  userName: '',
  responses: {},
  sectionsInScope: {},
  sectionsCollapsed: {},
  activeTab: 'full',
  auditLog: []
};
let saveTimeout = null;

/* ═══════════════════════════════════════════════
   INIT
   ═══════════════════════════════════════════════ */
document.addEventListener('DOMContentLoaded', () => {
  loadState();
  // If we have a saved user + customer name, bypass the gate
  if (state.userName && state.userName.trim() && state.customerName && state.customerName.trim()) {
    passGate();
  }
  // Enter key on gate inputs triggers start
  document.getElementById('gateUserName').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') startICQ();
  });
  document.getElementById('gateCustomerName').addEventListener('keydown', (e) => {
    if (e.key === 'Enter') startICQ();
  });
});

/* ═══════════════════════════════════════════════
   GATE LOGIC
   ═══════════════════════════════════════════════ */
function setGateMode(mode) {
  gateMode = mode;
  document.querySelectorAll('.gate-toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.gmode === mode);
  });
}

function startICQ() {
  const userInput = document.getElementById('gateUserName');
  const custInput = document.getElementById('gateCustomerName');
  const user = userInput.value.trim();
  const cust = custInput.value.trim();
  if (!user) {
    document.getElementById('gateError').textContent = 'Please enter your name to continue.';
    userInput.focus();
    return;
  }
  if (!cust) {
    document.getElementById('gateError').textContent = 'Please enter a customer name to continue.';
    custInput.focus();
    return;
  }
  document.getElementById('gateError').textContent = '';
  state.userName = user;
  state.customerName = cust;
  state.templateMode = gateMode;
  addAudit('login', 'Logged in (' + gateMode + ') for customer "' + cust + '"');
  saveNow();
  passGate();
}

function passGate() {
  document.getElementById('gateOverlay').classList.add('hidden');
  document.getElementById('appWrapper').classList.add('visible');
  document.getElementById('customerDisplay').textContent = state.customerName + ' | ' + state.userName;
  // Sync header toggle with state
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.mode === state.templateMode);
  });
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tab === state.activeTab);
  });
  renderICQ();
  updateStats();
}

/* ═══════════════════════════════════════════════
   STATE MANAGEMENT
   ═══════════════════════════════════════════════ */
function loadState() {
  try {
    const saved = localStorage.getItem(STORAGE_KEY);
    if (saved) {
      const parsed = JSON.parse(saved);
      state = { ...state, ...parsed };
    }
  } catch (e) {
    console.warn('Failed to load saved state:', e);
  }
  // Initialize scope defaults for conditional sections
  ICQ_DATA.sections.forEach(s => {
    if (s.conditional && state.sectionsInScope[s.id] === undefined) {
      state.sectionsInScope[s.id] = true;
    }
  });
}

function saveState() {
  clearTimeout(saveTimeout);
  saveTimeout = setTimeout(() => {
    saveNow();
  }, 300);
}

function saveNow() {
  try {
    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    showSaveIndicator();
  } catch (e) {
    console.warn('Failed to save state:', e);
  }
}

function showSaveIndicator() {
  const el = document.getElementById('saveIndicator');
  if (el) {
    el.classList.add('show');
    setTimeout(() => el.classList.remove('show'), 1500);
  }
}

/* ═══════════════════════════════════════════════
   SAVE / LOAD PROGRESS FILES
   ═══════════════════════════════════════════════ */
function saveProgress() {
  const data = {
    _type: 'icq-progress',
    _version: '2.0',
    savedAt: new Date().toISOString(),
    userName: state.userName,
    customerName: state.customerName,
    templateMode: state.templateMode,
    responses: state.responses,
    sectionsInScope: state.sectionsInScope,
    sectionsCollapsed: state.sectionsCollapsed,
    activeTab: state.activeTab,
    auditLog: state.auditLog
  };
  addAudit('export', 'Saved progress file');
  saveNow();
  const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const customerSlug = (state.customerName || 'unnamed').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
  a.href = url;
  a.download = `ICQ-Progress-${customerSlug}-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

function loadProgressFile(input, fromGate) {
  const file = input.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const data = JSON.parse(e.target.result);
      if (data._type !== 'icq-progress') {
        alert('Invalid file. Please select an ICQ progress file.');
        return;
      }
      // Restore state
      state.userName = data.userName || '';
      state.customerName = data.customerName || '';
      state.templateMode = data.templateMode || 'onprem';
      state.responses = data.responses || {};
      state.sectionsInScope = data.sectionsInScope || {};
      state.sectionsCollapsed = data.sectionsCollapsed || {};
      state.activeTab = data.activeTab || 'full';
      state.auditLog = data.auditLog || [];
      // Re-initialize any missing scope defaults
      ICQ_DATA.sections.forEach(s => {
        if (s.conditional && state.sectionsInScope[s.id] === undefined) {
          state.sectionsInScope[s.id] = true;
        }
      });
      addAudit('load', 'Loaded progress file: ' + file.name);
      saveNow();
      if (!state.customerName.trim()) {
        alert('Progress file has no customer name. Please enter a customer name.');
        return;
      }
      passGate();
    } catch (err) {
      alert('Failed to read progress file: ' + err.message);
    }
  };
  reader.readAsText(file);
  // Reset file input so same file can be re-selected
  input.value = '';
}

/* ═══════════════════════════════════════════════
   RENDER
   ═══════════════════════════════════════════════ */
function renderICQ() {
  const container = document.getElementById('mainContent');
  container.innerHTML = '';

  const mode = state.templateMode;
  const isNewTab = state.activeTab === 'new';

  // Group by category
  const aboutYou = ICQ_DATA.sections.filter(s => s.category === 'about-you');
  const aboutSolution = ICQ_DATA.sections.filter(s => s.category === 'about-solution');

  function renderGroup(title, sections) {
    // Filter sections that have visible questions
    const visibleSections = sections.filter(s => {
      if (s.scope !== 'both' && s.scope !== mode) return false;
      if (isNewTab) {
        const newQs = s.questions.filter(q =>
          q.isNew && (q.scope === 'both' || q.scope === mode)
        );
        return newQs.length > 0;
      }
      return true;
    });

    if (visibleSections.length === 0) return;

    const header = document.createElement('div');
    header.className = 'category-header';
    header.textContent = title;
    container.appendChild(header);

    visibleSections.forEach(section => {
      container.appendChild(renderSection(section, mode, isNewTab));
    });
  }

  renderGroup('About You', aboutYou);
  renderGroup('About the Solution', aboutSolution);
}

function renderSection(section, mode, isNewTab) {
  const el = document.createElement('div');
  el.className = 'section';
  el.dataset.sectionId = section.id;

  const isCollapsed = state.sectionsCollapsed[section.id];
  const isInScope = state.sectionsInScope[section.id] !== false;

  if (isCollapsed) el.classList.add('collapsed');
  if (!isInScope) el.classList.add('out-of-scope');

  // Get visible questions
  const visibleQuestions = section.questions.filter(q => {
    if (q.scope !== 'both' && q.scope !== mode) return false;
    if (isNewTab && !q.isNew) return false;
    return true;
  });

  const answeredCount = visibleQuestions.filter(q => (state.responses[q.ref] || '').trim()).length;
  const totalCount = visibleQuestions.length;
  const newCount = visibleQuestions.filter(q => q.isNew).length;

  // Header
  const header = document.createElement('div');
  header.className = 'section-header';
  header.innerHTML = `
    <div class="section-header-left">
      <span class="section-chevron">&#9660;</span>
      <span class="section-title"><span class="section-ref">${section.id}</span>${section.title}</span>
      <span class="section-progress">${answeredCount}/${totalCount}</span>
    </div>
    <div class="section-header-right">
      ${newCount > 0 && !isNewTab ? `<span class="new-count-badge">${newCount} NEW</span>` : ''}
      ${section.conditional ? `
        <label class="scope-toggle" onclick="event.stopPropagation()">
          <input type="checkbox" ${isInScope ? 'checked' : ''} onchange="toggleScope('${section.id}', this.checked)" />
          <span>${section.conditionalLabel || 'In Scope'}</span>
        </label>
      ` : ''}
    </div>
  `;

  header.addEventListener('click', (e) => {
    if (e.target.closest('.scope-toggle')) return;
    toggleCollapse(section.id);
  });

  el.appendChild(header);

  // Section progress bar
  const pct = totalCount > 0 ? Math.round((answeredCount / totalCount) * 100) : 0;
  const progressBar = document.createElement('div');
  progressBar.className = 'section-progress-bar';
  progressBar.innerHTML = `<div class="section-progress-fill" style="width:${pct}%"></div>`;
  el.appendChild(progressBar);

  // Body
  const body = document.createElement('div');
  body.className = 'section-body';

  visibleQuestions.forEach(q => {
    body.appendChild(renderQuestion(q));
  });

  el.appendChild(body);
  return el;
}

function renderQuestion(q) {
  const el = document.createElement('div');
  el.className = 'question-card';
  el.dataset.ref = q.ref;

  const answer = state.responses[q.ref] || '';
  if (answer.trim()) el.classList.add('answered');

  const whyId = 'why-' + q.ref.replace(/\./g, '-');
  const exId = 'ex-' + q.ref.replace(/\./g, '-');

  let inputHTML = '';
  if (q.inputType === 'select' && q.options) {
    const optionsHTML = q.options.map(o =>
      `<option value="${o}" ${answer === o ? 'selected' : ''}>${o}</option>`
    ).join('');
    inputHTML = `<select class="question-input" data-ref="${q.ref}" onchange="handleInput(this)">\n<option value="">-- Select --</option>\n${optionsHTML}\n</select>`;
  } else if (q.inputType === 'text') {
    inputHTML = `<input type="text" class="question-input" data-ref="${q.ref}" value="${escapeAttr(answer)}" placeholder="Enter your response..." oninput="handleInput(this)" />`;
  } else {
    inputHTML = `<textarea class="question-input" data-ref="${q.ref}" placeholder="Enter your response..." oninput="handleInput(this)">${escapeHTML(answer)}</textarea>`;
  }

  el.innerHTML = `
    <div class="question-header">
      <span class="question-ref">${q.ref}</span>
      <span class="question-text">${escapeHTML(q.text).replace(/\n/g, '<br>')}</span>
      ${q.isNew ? '<span class="new-badge">NEW</span>' : ''}
    </div>
    <div class="expand-row">
      ${q.whyRelevant ? `<button class="expand-btn" onclick="toggleExpand('${whyId}')">Why relevant?</button>` : ''}
      ${q.exampleResponse ? `<button class="expand-btn" onclick="toggleExpand('${exId}')">Example response</button>` : ''}
    </div>
    ${q.whyRelevant ? `<div class="expand-content" id="${whyId}"><div class="expand-label">Why is this relevant?</div>${escapeHTML(q.whyRelevant)}</div>` : ''}
    ${q.exampleResponse ? `<div class="expand-content" id="${exId}"><div class="expand-label">Example Response</div>${escapeHTML(q.exampleResponse).replace(/\n/g, '<br>')}</div>` : ''}
    ${inputHTML}
  `;

  return el;
}

/* ═══════════════════════════════════════════════
   EVENT HANDLERS
   ═══════════════════════════════════════════════ */
function handleInput(el) {
  const ref = el.dataset.ref;
  const oldVal = state.responses[ref] || '';
  state.responses[ref] = el.value;

  // Audit: log answer changes (debounced via a per-ref timer)
  clearTimeout(el._auditTimer);
  el._auditTimer = setTimeout(() => {
    if (el.value.trim() && el.value !== oldVal) {
      addAudit('answer', ref + ': answered');
      saveNow();
    } else if (!el.value.trim() && oldVal.trim()) {
      addAudit('answer', ref + ': cleared');
      saveNow();
    }
  }, 1000);

  // Update card styling
  const card = el.closest('.question-card');
  if (card) card.classList.toggle('answered', el.value.trim() !== '');

  // Update section progress bar
  const sectionEl = el.closest('.section');
  if (sectionEl) updateSectionProgress(sectionEl);

  saveState();
  updateStats();
}

function updateSectionProgress(sectionEl) {
  const cards = sectionEl.querySelectorAll('.question-card');
  const total = cards.length;
  const answered = Array.from(cards).filter(c => c.classList.contains('answered')).length;
  const pct = total > 0 ? Math.round((answered / total) * 100) : 0;
  const fill = sectionEl.querySelector('.section-progress-fill');
  if (fill) fill.style.width = pct + '%';
  const counter = sectionEl.querySelector('.section-progress');
  if (counter) counter.textContent = answered + '/' + total;
}

function setMode(mode) {
  state.templateMode = mode;
  document.querySelectorAll('.toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.mode === mode);
  });
  saveState();
  renderICQ();
  updateStats();
}

function setTab(tab) {
  state.activeTab = tab;
  document.querySelectorAll('.tab-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.tab === tab);
  });
  saveState();
  renderICQ();
  updateStats();
}

function toggleCollapse(sectionId) {
  state.sectionsCollapsed[sectionId] = !state.sectionsCollapsed[sectionId];
  const el = document.querySelector(`.section[data-section-id="${sectionId}"]`);
  if (el) el.classList.toggle('collapsed');
  saveState();
}

function toggleScope(sectionId, checked) {
  state.sectionsInScope[sectionId] = checked;
  const el = document.querySelector(`.section[data-section-id="${sectionId}"]`);
  if (el) el.classList.toggle('out-of-scope', !checked);
  addAudit('scope', sectionId + ': ' + (checked ? 'in scope' : 'out of scope'));
  saveState();
  updateStats();
}

function toggleExpand(id) {
  const el = document.getElementById(id);
  if (el) el.classList.toggle('show');
}

/* ═══════════════════════════════════════════════
   STATISTICS
   ═══════════════════════════════════════════════ */
function updateStats() {
  const mode = state.templateMode;
  let total = 0, answered = 0, totalNew = 0;

  ICQ_DATA.sections.forEach(section => {
    if (section.scope !== 'both' && section.scope !== mode) return;
    if (state.sectionsInScope[section.id] === false) return;

    section.questions.forEach(q => {
      if (q.scope !== 'both' && q.scope !== mode) return;
      total++;
      if (q.isNew) totalNew++;
      if ((state.responses[q.ref] || '').trim()) answered++;
    });
  });

  const remaining = total - answered;
  const pct = total > 0 ? Math.round((answered / total) * 100) : 0;

  document.getElementById('statTotal').textContent = total;
  document.getElementById('statAnswered').textContent = answered;
  document.getElementById('statRemaining').textContent = remaining;
  document.getElementById('statProgress').textContent = pct + '%';
  document.getElementById('progressBarFill').style.width = pct + '%';
  document.getElementById('tabFullCount').textContent = total;
  document.getElementById('tabNewCount').textContent = totalNew;
}

/* ═══════════════════════════════════════════════
   EXPORT
   ═══════════════════════════════════════════════ */
function exportJSON() {
  addAudit('export', 'Exported JSON (' + state.templateMode + ')');
  saveNow();
  const mode = state.templateMode;
  const exportData = {
    meta: {
      ...ICQ_DATA.meta,
      exportedAt: new Date().toISOString(),
      templateMode: mode,
      customerName: state.customerName
    },
    sections: []
  };

  ICQ_DATA.sections.forEach(section => {
    if (section.scope !== 'both' && section.scope !== mode) return;

    const inScope = state.sectionsInScope[section.id] !== false;
    const sectionExport = {
      id: section.id,
      title: section.title,
      inScope: inScope,
      questions: []
    };

    section.questions.forEach(q => {
      if (q.scope !== 'both' && q.scope !== mode) return;
      sectionExport.questions.push({
        ref: q.ref,
        text: q.text,
        response: state.responses[q.ref] || '',
        isNew: q.isNew
      });
    });

    exportData.sections.push(sectionExport);
  });

  const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const customerSlug = (state.customerName || 'unnamed').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
  a.href = url;
  a.download = `ICQ-${customerSlug}-${mode}-${new Date().toISOString().split('T')[0]}.json`;
  a.click();
  URL.revokeObjectURL(url);
}

/* ═══════════════════════════════════════════════
   RESET
   ═══════════════════════════════════════════════ */
function showResetModal() {
  document.getElementById('resetModal').classList.add('show');
}
function hideResetModal() {
  document.getElementById('resetModal').classList.remove('show');
}
function doReset() {
  addAudit('reset', 'Reset all responses');
  // Preserve audit log across reset
  const preservedLog = [...state.auditLog];
  localStorage.removeItem(STORAGE_KEY);
  state = {
    templateMode: 'onprem',
    customerName: '',
    userName: '',
    responses: {},
    sectionsInScope: {},
    sectionsCollapsed: {},
    activeTab: 'full',
    auditLog: preservedLog
  };
  // Re-initialize scope defaults
  ICQ_DATA.sections.forEach(s => {
    if (s.conditional) state.sectionsInScope[s.id] = true;
  });
  hideResetModal();
  // Return to gate
  document.getElementById('appWrapper').classList.remove('visible');
  document.getElementById('gateOverlay').classList.remove('hidden');
  document.getElementById('gateUserName').value = '';
  document.getElementById('gateCustomerName').value = '';
  document.getElementById('gateError').textContent = '';
  gateMode = 'onprem';
  document.querySelectorAll('.gate-toggle-btn').forEach(btn => {
    btn.classList.toggle('active', btn.dataset.gmode === 'onprem');
  });
}

/* ═══════════════════════════════════════════════
   AUDIT LOG
   ═══════════════════════════════════════════════ */
function addAudit(type, detail) {
  state.auditLog.push({
    ts: new Date().toISOString(),
    user: state.userName || '(unknown)',
    type: type,
    detail: detail
  });
}

function showAuditModal() {
  const wrap = document.getElementById('auditTableWrap');
  const log = state.auditLog;
  if (!log.length) {
    wrap.innerHTML = '<div class="audit-empty">No audit entries yet.</div>';
  } else {
    let html = '<table class="audit-table"><thead><tr><th>Timestamp</th><th>User</th><th>Action</th><th>Detail</th></tr></thead><tbody>';
    // Show newest first
    for (let i = log.length - 1; i >= 0; i--) {
      const e = log[i];
      const time = new Date(e.ts).toLocaleString();
      html += `<tr><td>${escapeHTML(time)}</td><td>${escapeHTML(e.user)}</td><td><span class="audit-type ${e.type}">${e.type}</span></td><td>${escapeHTML(e.detail)}</td></tr>`;
    }
    html += '</tbody></table>';
    wrap.innerHTML = html;
  }
  document.getElementById('auditModal').classList.add('show');
}

function hideAuditModal() {
  document.getElementById('auditModal').classList.remove('show');
}

function exportAuditLog() {
  const log = state.auditLog;
  if (!log.length) { alert('No audit entries to export.'); return; }
  const rows = [['Timestamp', 'User', 'Action', 'Detail']];
  log.forEach(e => {
    rows.push([e.ts, e.user, e.type, '"' + (e.detail || '').replace(/"/g, '""') + '"']);
  });
  const csv = rows.map(r => r.join(',')).join('\n');
  const blob = new Blob([csv], { type: 'text/csv' });
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  const customerSlug = (state.customerName || 'unnamed').replace(/[^a-zA-Z0-9]/g, '-').toLowerCase();
  a.href = url;
  a.download = `ICQ-Audit-${customerSlug}-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  URL.revokeObjectURL(url);
}

/* ═══════════════════════════════════════════════
   UTILITIES
   ═══════════════════════════════════════════════ */
function escapeHTML(str) {
  const div = document.createElement('div');
  div.textContent = str;
  return div.innerHTML;
}
function escapeAttr(str) {
  return str.replace(/"/g, '&quot;').replace(/'/g, '&#39;').replace(/</g, '&lt;').replace(/>/g, '&gt;');
}
</script>
</body>
</html>